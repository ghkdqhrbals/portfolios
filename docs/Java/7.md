---
layout: default
title: ğŸ“Œ Spring-Java ì—ì„œì˜ Sync/Async Blocking/Non-Blocking êµ¬í˜„ ë°©ë²•
parent: Java-Spring
nav_order: 9
---

ë‹¤ë“¤ ë™ê¸°/ë¹„ë™ê¸°ì™€ Blocking/Non-blocking ì„ í•œë²ˆì”© ë“¤ì–´ë³´ì…¨ì„ê±°ì—ìš”.

í•˜ì§€ë§Œ Spring-Java ì—ì„œ ì´ë¥¼ ì„ì€ ì¡°í•©ì— ëŒ€í•œ ì‹¤ì œ êµ¬í˜„ ë°©ì‹ì„ ì„¤ëª…í•˜ëŠ” ê¸€ì´ ë³„ë¡œ ì—†ë”ë¼êµ¬ìš”.

ê·¸ë˜ì„œ! ì˜¤ëŠ˜ì˜ í¬ìŠ¤íŒ…ì€ í•´ë‹¹ êµ¬í˜„ ë°©ì‹ì— ëŒ€í•´ ìì„¸íˆ ì„¤ëª…í•˜ë ¤ê³  í•©ë‹ˆë‹¤.


## 1. ë¹„ë™ê¸°/ë™ê¸°ì™€ Blocking/Non-blocking ì˜ ì°¨ì´ì 
### 1.1 Sync vs Async
> **í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì˜ ì‘ì—… ì™„ë£Œ ì—¬ë¶€ë¥¼ ëˆ„ê°€ ì‹ ê²½ì“°ëƒê°€ ê´€ì‹¬ì‚¬!**

A ìŠ¤ë ˆë“œê°€ B ìŠ¤ë ˆë“œì—ê²Œ ìš”ì²­í–ˆì„ ë•Œ,
* Sync : A ìŠ¤ë ˆë“œëŠ” **ì§ì ‘ì **ìœ¼ë¡œ B ìŠ¤ë ˆë“œì—ê²Œ ê²°ê³¼ìš”ì²­ ë©”ì„¸ì§€ë¥¼ ì „ì†¡í•¨. ì¦‰, ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì‘ì—… ì™„ë£Œ ì—¬ë¶€ë¥¼ ì²´í¬í•¨.
* Async : B ìŠ¤ë ˆë“œê°€ A ìŠ¤ë ˆë“œì—ê²Œ ê²°ê³¼ë¥¼ ì „ë‹¬í•¨ìœ¼ë¡œì¨, ê²°ê³¼ë¥¼ **ê°„ì ‘ì **ìœ¼ë¡œ ë°›ìŒ. ì¦‰, ì„œë¸Œ ìŠ¤ë ˆë“œê°€ ì‘ì—… ì™„ë£Œ ì—¬ë¶€ë¥¼ ë©”ì¸ì— ì „ì†¡í•¨.

### 1.2 Blocking vs Non-blocking
> **í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ê°€ ë°”ë¡œ ë¦¬í„´í•˜ëŠëƒ ë§ˆëŠëƒê°€ ê´€ì‹¬ì‚¬!**

A ìŠ¤ë ˆë“œê°€ B ìŠ¤ë ˆë“œì—ê²Œ ìš”ì²­í–ˆì„ ë•Œ,
* Blocking :  A ìŠ¤ë ˆë“œëŠ” ë¦¬í„´ì„ ë°›ê¸° ì „ê¹Œì§€ ë‹¤ìŒì˜ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŒ
* Non-blocking : ê·¸ë ‡ì§€ ì•Šê³  ìš”ì²­ê³¼ ë™ì‹œì— ë‹¤ìŒì˜ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŒ

## 2. ì¡°í•©ì— ë”°ë¥¸ 4 ê²½ìš°ì˜ êµ¬í˜„ì°¨ì´ì  (feat. CompletableFuture + WebFlux)

{: .important}
> ê¸°ë³¸ì ìœ¼ë¡œ CompletableFuture ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´, ê²°ê³¼ëŠ” `.get()`ì´ë‚˜ `.join()`ë©”ì†Œë“œë¥¼ í†µí•´ ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ìˆ˜ì‹ í•´ì•¼í•´ìš”. 
> ê·¸ë¦¬ê³  ì´ ë©”ì†Œë“œë“¤ì€ **Blocking** ë©”ì†Œë“œì…ë‹ˆë‹¤. ì¦‰, CompletableFuture ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´, ì‹¤ì§ˆì ì¸ Non-Blocking êµ¬í˜„ì´ í˜ë“¤ì–´ìš”.
ì™œëƒí•˜ë©´ ì–´ì¨‹ë“  ê²°ê³¼ë¥¼ Blocking ìœ¼ë¡œ ë°›ê¸° ë•Œë¬¸ì´ì£ !. 
> 
> ê·¸ë˜ì„œ ì €ëŠ” **Flux** ì™€ **Sink** ê°ì²´ë¥¼ í†µí•´ **Non-blocking** êµ¬í˜„ì„ í•˜ì˜€ì–´ìš”. [WebFlux](https://ghkdqhrbals.github.io/portfolios/docs/Java/2/) í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ì–‘í•œ ì˜ˆì‹œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![img](../../../assets/img/java/1.png)
Reference : [https://www.inflearn.com/news/72620](https://www.inflearn.com/news/72620)

### 2.1 Async + Blocking( **CompletableFuture** )

* CompletableFuture ë¥¼ í™œìš©í•œ ì½”ë“œ

```java
void async_blocking() throws ExecutionException, InterruptedException {
    ThreadPoolTaskExecutor t = getThreadPoolTaskExecutor();
    System.out.println("[Thread 1] - ì‘ì—… ì‹œì‘í• ê²Œìš”");

    // Async
    CompletableFuture<String> completableFuture = CompletableFuture.supplyAsync(() -> {
        try {Thread.sleep(500);} catch (InterruptedException e) {throw new RuntimeException(e);}
        System.out.println("[Thread 2] - [Thread 1]ìœ¼ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ì‘ì—… ì²˜ë¦¬í• ê²Œìš”");
        return "Thread 2ì˜ ê²°ê³¼ë¬¼";
    },t);

    // Blocking
    String result = completableFuture.get();

    System.out.println("[Thread 1] - ëë‚¬êµ°ìš”! ê²°ê³¼ë¬¼ì€ : \""+result+"\", ì´ì œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰í• ê²Œìš”");
    System.out.println("[Thread 1] ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰ ì¤‘...");

    t.destroy();
}
```

* ê²°ê³¼

```
[Thread 1] - ì‘ì—… ì‹œì‘í• ê²Œìš”
[Thread 2] - [Thread 1]ìœ¼ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ì‘ì—… ì²˜ë¦¬í• ê²Œìš”
[Thread 1] - ëë‚¬êµ°ìš”! ê²°ê³¼ë¬¼ì€ : "Thread 2ì˜ ê²°ê³¼ë¬¼", ì´ì œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰í• ê²Œìš”
[Thread 1] ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰ ì¤‘...
```

### 2.2 Async + Non-blocking( **CompletableFuture** + **WebFlux** )
* CompletableFuture ì— WebFlux ë¥¼ ì¶”ê°€í•œ ì½”ë“œ

```java
void async_non_blocking() throws ExecutionException, InterruptedException {
    ThreadPoolTaskExecutor t = getThreadPoolTaskExecutor();
    Sinks.Many<Object> sinks = Sinks.many().replay().all();

    System.out.println("[Thread 1] - ì‘ì—… ì‹œì‘í• ê²Œìš”");

    // Async
    CompletableFuture.runAsync(() -> {
        try {Thread.sleep(500);} catch (InterruptedException e) {throw new RuntimeException(e);}
        System.out.println("[Thread 2] - [Thread 1]ìœ¼ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ì‘ì—… ì²˜ë¦¬í• ê²Œìš”");
        sinks.tryEmitNext("Thread 2ì˜ ê²°ê³¼ë¬¼");
    },t);

    // Non-Blocking
    sinks.asFlux().log().subscribe(result->{
        System.out.println("[Thread 1] - ëë‚¬êµ°ìš”! ê²°ê³¼ë¬¼ì€ : \""+result+"\", ì´ì œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰í• ê²Œìš”");
    });

    System.out.println("[Thread 1] ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰ ì¤‘...");

    try {Thread.sleep(1000);} catch (InterruptedException e) {throw new RuntimeException(e);}
    t.destroy();
}
```

* ê²°ê³¼

```
[Thread 1] - ì‘ì—… ì‹œì‘í• ê²Œìš”
[Thread 1] INFO reactor.Flux.SinkManyReplayProcessor.1 -- | onSubscribe([Fuseable] SinkManyReplayProcessor.ReplayInner)
[Thread 1] INFO reactor.Flux.SinkManyReplayProcessor.1 -- | request(unbounded)
[Thread 1] ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰ ì¤‘...
[Thread 2] - [Thread 1]ìœ¼ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ì‘ì—… ì²˜ë¦¬í• ê²Œìš”
[Thread 2] INFO reactor.Flux.SinkManyReplayProcessor.1 -- | onNext(Thread 2ì˜ ê²°ê³¼ë¬¼)
[Thread 1] - ëë‚¬êµ°ìš”! ê²°ê³¼ë¬¼ì€ : "Thread 2ì˜ ê²°ê³¼ë¬¼", ì´ì œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰í• ê²Œìš”
```

### 2.3 Sync + Blocking( **IORead** )

ì´ ë¶€ë¶„ì€ `file.read()`, `file.write()` ì™€ ê°™ì´ ê°„ë‹¨í•œ ì˜ˆì‹œì´ê¸°ë•Œë¬¸ì— ìƒëµí•˜ê² ìŠµë‹ˆë‹¤.

### 2.4 Sync + Non-blocking( **CompletableFuture** )

ì´ ë¶€ë¶„ì€ ê°„ëµí•œ ì˜ˆì‹œë¥¼ ë“¤ê¸° ìœ„í•´ CompletableFuture ì„ ì‚¬ìš©í–ˆì–´ìš”. 
í•˜ì§€ë§Œ! ì´ ì˜ˆì‹œëŠ” ì™„ë²½í•œ Sync + Non-blocking ì˜ˆì‹œê°€ ì•„ë‹ˆë¼ëŠ” ì ì„ ì•Œì•„ì£¼ì„¸ìš”.
ì™œëƒí•˜ë©´ ì•„ë˜ ì½”ë“œì˜ `completableFuture.get()` ëŠ” ê²°êµ­ Blocking ì´ê±°ë“ ìš”.
ë‹¤ë§Œ ì´ì „ì— `completableFuture.isDone()` ìœ¼ë¡œ `Thread 1` ì´ ì§ì ‘ì ìœ¼ë¡œ `Thread 2` ì—ê²Œ ì‘ì—…ì™„ë£Œì—¬ë¶€ë¥¼ ë¬¼ì–´ë³´ê¸°ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì€ ì˜ˆì‹œë¥¼ ë“¤ì—ˆìŠµë‹ˆë‹¤.
ì‹¤ì œ Sync + Non-blocking ì€ `asyncFileChannel.read` ì™€ ê°™ì€ ì˜ˆì‹œì…ë‹ˆë‹¤.

```java
void sync_non_blocking() throws ExecutionException, InterruptedException {
    ThreadPoolTaskExecutor t = getThreadPoolTaskExecutor();
    System.out.println("[Thread 1] - ì‘ì—… ì‹œì‘í• ê²Œìš”");
    
    // Async ì´ì§€ë§Œ, ì•„ë˜ì˜ completableFuture.isDone()ì„ í†µí•œ callBack ë¬´ì‹œë¡œ ê²°ë¡ ì€ Sync
    CompletableFuture<String> completableFuture = CompletableFuture.supplyAsync(() -> {
        System.out.println("[Thread 2] - [Thread 1]ìœ¼ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ì‘ì—… ì²˜ë¦¬í• ê²Œìš”");
        try {Thread.sleep(500);} catch (InterruptedException e) {throw new RuntimeException(e);}
        return "Thread 2ì˜ ê²°ê³¼ë¬¼";
    },t);

    // Non-Blocking
    while(!completableFuture.isDone()){
        Thread.sleep(200);
        System.out.println("[Thread 1] - Thread 2ë‹˜ ì‘ì—…ì´ ëë‚¬ë‚˜ìš”? ê·¸ë™ì•ˆ ì €ëŠ” ë‹¤ë¥¸ì¼ ì¢€ í• ê²Œìš”");
        System.out.println("[Thread 1] - ë‹¤ë¥¸ ì¼ ì¤‘...");
    }
    // ë‹¤ìŒ ì‘ì—…
    System.out.println("[Thread 1] - ëë‚¬êµ°ìš”! ê²°ê³¼ë¬¼ì€ : \""+completableFuture.get()+"\", ì´ì œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰í• ê²Œìš”");
    System.out.println("[Thread 1] ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰ ì¤‘...");

    t.destroy();
}
```

* ê²°ê³¼

```
[Thread 1] - ì‘ì—… ì‹œì‘í• ê²Œìš”
[Thread 2] - [Thread 1]ìœ¼ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ì‘ì—… ì²˜ë¦¬í• ê²Œìš”
[Thread 1] - Thread 2ë‹˜ ì‘ì—…ì´ ëë‚¬ë‚˜ìš”? ê·¸ë™ì•ˆ ì €ëŠ” ë‹¤ë¥¸ì¼ ì¢€ í• ê²Œìš”
[Thread 1] - ë‹¤ë¥¸ ì¼ ì¤‘...
[Thread 1] - Thread 2ë‹˜ ì‘ì—…ì´ ëë‚¬ë‚˜ìš”? ê·¸ë™ì•ˆ ì €ëŠ” ë‹¤ë¥¸ì¼ ì¢€ í• ê²Œìš”
[Thread 1] - ë‹¤ë¥¸ ì¼ ì¤‘...
[Thread 1] - Thread 2ë‹˜ ì‘ì—…ì´ ëë‚¬ë‚˜ìš”? ê·¸ë™ì•ˆ ì €ëŠ” ë‹¤ë¥¸ì¼ ì¢€ í• ê²Œìš”
[Thread 1] - ë‹¤ë¥¸ ì¼ ì¤‘...
[Thread 1] - ëë‚¬êµ°ìš”! ê²°ê³¼ë¬¼ì€ : "Thread 2ì˜ ê²°ê³¼ë¬¼", ì´ì œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰í• ê²Œìš”
[Thread 1] ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰ ì¤‘...
```