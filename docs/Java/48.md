---
layout: default
title: CDC table change event
parent: Server
date: 2025-12-29
---

# 소스 테이블의 스키마가 변경되면?

CDC 수행 중 소스 테이블 스키마가 변경되면, Debezium은 변경 이후의 전체 테이블 스키마 정보를 포함한 change event를 생성합니다. 이벤트를 직렬화 결과 기준으로 보면, 단순 ddl 로그가 아니라 변경된 시점의 컬럼 전체 메타데이터가 함께 전달됩니다. 이때 역직렬화 단계에서 분기 처리한다면, 스키마 변경으로 인한 문제 없이 파이프라인을 유지할 수 있습니다.

소스 DB의 컬럼 변경이 타깃 DB 스키마 변경으로 이어져야 하는 경우, 이러한 이벤트를 파싱해 타깃 스키마까지 동기화 해주면 됩니다. 제 경우 MySQL → MongoDB 구조라 스키마리스 특성과 공용 모델 사용 덕분에 문제가 없지만, MySQL → PostgreSQL과 같은 경우에는 반드시 이 부분을 고려해야 합니다.

# 스냅샷을 빠르게 하고싶다면?

초기 CDC 를 도입하다보면 타겟 테이블이 오염되었을 경우가 존재합니다. 주문정보가 순서가 바뀌었거나, 특정 기간 데이터가 누락되는 등 다양한 이유로 인해 타겟 테이블을 초기화하고 다시 스냅샷을 떠야 하는 상황이 발생할 수 있습니다. 이 때 복구하기 위해 깨끗한 타겟 테이블을 만들고 debezium 스냅샷으로 1개씩 전부 복구하는 과정은 시간이 정말 오래걸립니다. 이럴 땐 [대규모 CDC Pipeline 운영을 위한 Debezium 개선 여정](https://toss.tech/article/cdc_pipeline) 에서 처럼 1개씩 source -> bp -> target 으로 보내는게 아니라, 배치로 깨끗한 테이블에 초기 데이터 적재를 수행한 뒤 debezium.source.snapshot.mode 를 `no_data` 로 설정해서 스냅샷 단계를 건너뛰고 바로 변경로그부터 처리하도록 할 수 있습니다. 이 떄 주의해야할 부분은 배치싱크 시점과 debezium 의 변경로그 오프셋 시작 시점이 잘 맞아야 한다는 점입니다. 

이를 위해서 2가지 단계가 필수입니다.

1. sink connector 은 멱등성을 보장해야한다.
2. 

`SHOW MASTER STATUS` 이 명령어로 배치시작 전 