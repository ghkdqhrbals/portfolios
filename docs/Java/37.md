---
layout: default
title: Mysql - Redis stream - Mongodb CDC + ETL setup
date: 2025-09-16
parent: ğŸ“Œ Server
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

# Intro

ê¸°ì¡´ì— ì €í¬ëŠ” Mysql ë¥¼ main db ë¡œ, ë©€í‹°í”„ë Œì°¨ì´ì¦ˆë¥¼ ëª©í‘œë¡œ ìš´ì˜í•˜ë‹¤ë³´ë‹ˆ ì—¬ëŸ¬ ë‹¤ì–‘í•œ ìŠ¤í‚¤ë§ˆë“¤ì´ í•„ìš”í–ˆê³  ì´ë¥¼ ìœ„í•œ Mongodb ë¥¼ secondary db ë¡œ ìš´ì˜í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì‹ ê·œ í”¼ì²˜ë¡œ ëŒ€ëŸ‰ì˜ íšŒì›ì¶”ì¶œì„ ì§„í–‰í•˜ê¸° ìœ„í•´ mysql slave ë¥¼ ë³´ëŠ” ê²ƒì´ ì•„ë‹Œ, cdc ë¥¼ í†µí•´ì„œ Mongodb ì— íšŒì›ì •ë³´ë¥¼ upsert í•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ì—¬ëŸ¬ê°€ì§€ ì¡°ê±´ë“¤ì˜ í…Œì´ë¸”ì„ ë‹¨ì¼ docs ë¡œ í•©ì¹˜ê²Œ ëœë‹¤ë©´ mysql ì—ì„œ ì²˜ëŸ¼ join êµ³ì´ ì•ˆí•´ë„ ë˜ê¸°ë•Œë¬¸ì— ë¹ ë¥´ê²Œ ì¡°íšŒê°€ ê°€ëŠ¥í•´ ì§‘ë‹ˆë‹¤.

ê·¸ë˜ì„œ Debezium server ì„ ì‚¬ìš©í•˜ì—¬ Mysql binlog ë¥¼ cdc í•˜ê³ , ì´ë¥¼ Redis Stream ìœ¼ë¡œ ë³´ë‚´ê³ , ë³„ë„ sink pod ì—ì„œ Redis Stream í•´ë‹¹ í† í”½ ì½ê³  Mongodb ì— upsert í•˜ëŠ” êµ¬ì¡°ë¡œ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

> [OLAP](https://en.wikipedia.org/wiki/Online_analytical_processing) ì—ëŠ” [https://medium.com/@simeon.emanuilov/mongodb-vs-clickhouse-for-olap-1e430a40ade8](https://medium.com/@simeon.emanuilov/mongodb-vs-clickhouse-for-olap-1e430a40ade8) ClickHouse ê°€ Big Data Query ì— ì¢€ ë” ì¢‹ë‹¤ê³ ëŠ” í•˜ë„¤ìš”. ì˜ˆë¡œ createdAt ê°™ì€ ì¹¼ëŸ¼ì„ ìƒëŒ€ë¡œ 10ì›” ë°ì´í„° ì¡°íšŒí•˜ë©´ ClickHouse ê°€ ë” ë¹ ë¥´ë‹¤ê³ í•©ë‹ˆë‹¤.

ì´ ê³¼ì •ì„ ì •ë¦¬ë˜ì§€ ì•Šì€ ê¸°ë¡ìœ¼ë¡œ ìš°ì„  ë‚¨ê¹ë‹ˆë‹¤.


# Debezium Server CDC

- kafka ì—†ì´ ì¼ë°˜ debezium server ë¡œ ì§„í–‰
    - reference: [https://debezium.io/documentation/reference/3.2](https://debezium.io/documentation/reference/3.2/)
    - https://debezium.io/documentation/reference/stable/operations/debezium-server.html    
    > ~~ê³µì‹ë¬¸ì„œì—ì„œ ë³´ë©´ debezium.sink.type ì„¤ì •ì´ aws í‚¤ë„¤ì‹œìŠ¤ë°–ì— ì—†ì–´ì„œ ë‹¤ë¥¸ê±° í™•ì¸ ì¤‘â€¦ stream ì„ ê¼­ ì¨ì•¼í•˜ë‚˜? kafka ë§ê³  redis stream ë„ ì§€ì›í•˜ê¸´ í•˜ëŠ”ë° source/sink ê°€ stream -> mongodb ìˆëŠ”ì§€ ë´ì•¼í•¨.~~
* **kafka stream â†’ mongodb sink connector ì€ ìˆê³  redis stream â†’ mongodb sink connector ì€ ì—†ìŒ... ë³„ë„ì˜ pod ë¥¼ ë„ì›Œì„œ redis stream key ì½ê³  mongodb ì— upsert í•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•´ì•¼í•  ê²ƒ ê°™ë‹¤.**
- [https://tech.kakaopay.com/post/kakaopaysec-mongodb-cdc/#4-consumer-group-ìƒì„±-ë°-offset-ì„¤ì •](https://tech.kakaopay.com/post/kakaopaysec-mongodb-cdc/#4-consumer-group-%EC%83%9D%EC%84%B1-%EB%B0%8F-offset-%EC%84%A4%EC%A0%95) ì¹´ì¹´ì˜¤í˜ì´ì—ì„œëŠ” kafka sink connector ì‚¬ìš©í•¨. ìš°ë¦¬ëŠ” redis stream ì“°ê¸°ë•Œë¬¸ì— ë³„ë„ë¡œ ë§Œë“¤ì–´ì•¼í•¨.

* debezium server â†’ redis stream ì„¤ì •ê°’ ê³µì‹ reference
    * https://debezium.io/documentation/reference/2.7/operations/debezium-server.html#_redis_stream

* django í†µí•´ì„œ postgresql â†’ mongodb ì§ì ‘ sink í•œ ì˜¤í”ˆì†ŒìŠ¤. ê³µì‹ìœ¼ë¡œ ì§€ì›í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ê·¸ëƒ¥ ì°¸ê³ ìš©. [https://github.com/maqboolthoufeeq/cdc_debezium](https://github.com/maqboolthoufeeq/cdc_debezium)
    * https://dev.to/maqboolthoufeeq/change-data-capture-cdc-with-debezium-server-no-kafka-django-postgres-mongodb-example-m0h

- Mysql â†’ Debezium Server â†’ Redis Stream ì˜ í”„ë¡œì„¸ìŠ¤ ì†Œê°œ
1. Snapshots
    - Debezium Server ê°€ ë™ì‘í•  ë•Œ í˜„ì¬ SQL server ìƒíƒœì˜ ìŠ¤ëƒ…ìƒ·ì„ ì°ìŒ. defaultê°€ INITIAL
        - recovery, custom, initial_only, etc.
    - ê·¸ë˜ì„œ ì–´ëŠ í…Œì´ë¸”ì„ Capture í• ê±°ì•¼? ì •í•  ìˆ˜ ìˆìŒ. [`table.include.list`](https://debezium.io/documentation/reference/stable/connectors/sqlserver.html#sqlserver-property-table-include-list) íŒŒë¼ë¯¸í„° ê°’ìœ¼ë¡œ
- insert sql í…ŒìŠ¤íŠ¸. insert í›„ 1 ì¦ê°€ í™•ì¸
    - `ghkdqhrbals@ip-172-30-1-90 debezium-server % redis-cli --json XREVRANGE mysql_sink.gyumin.users + - COUNT 1 | jq -r '.[0][1][1] | fromjson | .payload.after.id'` **30001**
    - `ghkdqhrbals@ip-172-30-1-90 debezium-server % redis-cli --json XREVRANGE mysql_sink.gyumin.users + - COUNT 1 | jq -r '.[0][1][1] | fromjson | .payload.after.id'` **30002**
- í˜ì´ë¡œë“œ í™•ì¸
    - payload(insert ëŠ” before ì—†ê³  update ëŠ” before ì¡´ì¬. + db & table ë¬¶ê³  ë¶„ê¸°í•˜ì—¬ mongodb upsert í•˜ë©´ ë  ë“¯)
    - payload
        
        ```json
        ...
        "payload": {
            "before": null,
            "after": {
              "id": 30002,
              "name": "í…ŒìŠ¤íŠ¸ìš© ìœ ì €",
              // ...
            },
            "source": {
              "version": "3.2.0.Final",
              "connector": "mysql",
              "name": "mysql_sink",
              "ts_ms": 1755138551000,
              "snapshot": "false", // ì´ê±°ëŠ” initial ë‹¨ê³„ì—ì„œ ì¶”ê°€ëœ ê²Œ ì•„ë‹ˆë¼ ì´í›„ cdc í•œê±°ì„.
              "db": "gyumin",
              "sequence": null,
              "ts_us": 1755138551000000,
              "ts_ns": 1755138551000000000,
              "table": "users",
              "server_id": 1,
              "gtid": null,
              "file": "binlog.000002",
              "pos": 7114433,
              "row": 0,
              "thread": 385,
              "query": null
            },
            "transaction": null,
            "op": "c", // c(insert). u(update), d(delete), r(read), t(truncate)
            // ì´ˆê¸°ì— db ì½ì–´ì™€ì„œ redis stream ë¡œë“œì‹œí‚¬ ë–„ r ë¡œ ë“¤ì–´ê°.
            "ts_ms": 1755138551799,
            "ts_us": 1755138551799549,
            "ts_ns": 1755138551799549000
          }
        ```
        

- source binload ì„¸íŒ…
    
    ```json
    // source binload ì„¸íŒ…
    "source": {
      "version": "3.2.0.Final",         // 2025.08.17 ì— stable í•œ ìµœì‹  ë²„ì „ì„. 
      "connector": "mysql",              
      "name": "mysql_sink",              
      "ts_ms": 1755138551000,            // ì†ŒìŠ¤ ì´ë²¤íŠ¸ ì‹œê°(ms). MySQLì˜ binlog ì´ë²¤íŠ¸ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜
      "snapshot": "false",               // ìŠ¤ëƒ…ìƒ· ì—¬ë¶€: true(ê¸°ì¡´ db ì— ìˆë˜ rows ì½ì–´ì˜¬ ë•Œ), false(ì‹¤ì‹œê°„ cdc)
      "db": "gyumin",                  
      "sequence": null,                  
      "ts_us": 1755138551000000,         // binlog í•´ë‹¹ ì´ë²¤íŠ¸ ì‹œê°„
      "ts_ns": 1755138551000000000,      
      "table": "users",                  // cdc í•œ í…Œì´ë¸”
      "server_id": 1,                    // mysql server id. ì´ê±° ê°’ì„ config ì—ì„œ ìš°ë¦¬ê°€ ì„¤ì •ê°€ëŠ¥
      "gtid": null,                      // GTID ëª¨ë“œ ì‚¬ìš© ì‹œ í•´ë‹¹ íŠ¸ëœì­ì…˜ì˜ GTID. ë¹„í™œì„±í™”ë©´ null
      "file": "binlog.000002",           // ì´ë²¤íŠ¸ë¥¼ ë‹´ê³  ìˆëŠ” binlog íŒŒì¼ëª…
      "pos": 7114433,                    // ìœ„ binlog íŒŒì¼ ë‚´ ì˜¤í”„ì…‹. debezium server ì¬ì‹œì‘í•˜ë©´ ì—¬ê¸°ì„œë¶€í„° ë‹¤ì‹œ cdc í•¨.
      "row": 0,                          // insert values 2ê°œë©´ row 0, 1 ë¡œ ë‚˜ë‰¨.
      "thread": 385,                     // mysql db ì„¸ì…˜ì˜ id
      "query": null                      // ddl ì¿¼ë¦¬. dml ì—ì„œëŠ” null ë¡œ í‘œì‹œí•¨. ì´ê±°ëŠ” insert í•œê±°ë¼ null
    }
    ```
    

- update ì‹œ í˜ì´ë¡œë“œ ì²´í¬.
    
    > ì „ì²´ row ë³€ê²½ì ì´ ê¸°ë¡ë˜ê¸°ë•Œë¬¸ì— upsert ì¹˜ê¸° ì¢‹ê¸´ í•¨. ë³€ê²½ëœ ë¶€ë¶„ë§Œ binlog ì— ê¸°ë¡ë˜ëŠ”ê²Œ ì•„ë‹Œ. mysql ì—ì„  `SHOW VARIABLES LIKE 'binlog_row_image';` ì´ê±° FULL ì´ë©´ ì „/í›„ row ë³€ê²½ì ì„ ë‹¤ ê¸°ë¡í•¨. postgresql ì—ì„œëŠ” wal_level=logical ì´ë‘ ë¹„ìŠ·í•¨.
    > 
    > 
    > ```json
    >   "payload": {
    >     "before": {
    >       "id": 30000,
    >       "name": "í…ŒìŠ¤íŠ¸ìš©",
    >       // ...
    >     },
    >     "after": {
    >       "id": 30000,
    >       "name": "í…ŒìŠ¤íŠ¸ìš© ë³€ê²½",
    >       // ...
    >     }
    > ```
    > 

- binlog ì˜¤í”„ì…‹ ì²´í¬ `HGETALL metadata:debezium:offsets`

    `{  "ts_sec": 1755155084,  "file": "binlog.000002",  "pos": 7117146}`
    

> ì„¤ì • reference : https://redis.io/docs/latest/integrate/write-behind/reference/debezium/mysql/

```yaml
# SINK SETTINTGS
debezium.sink.type=redis
debezium.sink.redis.address=localhost:6379
debezium.sink.redis.db.index=0

# SOURCE SETTINGS
# reference=https://redis.io/docs/latest/integrate/write-behind/reference/debezium/mysql/
debezium.source.connector.class=io.debezium.connector.mysql.MySqlConnector
debezium.source.database.server.id=111
debezium.source.database.dbname=gyumin
debezium.source.database.hostname=localhost
debezium.source.database.port=3306
debezium.source.database.user=root
# debezium.source.databbase.password=
debezium.source.snapshot.mode=initial
# <DB_NAME>.<TABLE_NAME> ìœ¼ë¡œ í…Œì´ë¸” ì§€ì •í•¨. ê·¸ë¦¬ê³  ì•„ë˜ ë¼ì¸ regex ì ìš©ìœ¼ë¡œ ',' separate ì‹œí‚¤ê¸°ë•Œë¬¸ì— í•´ë‹¹ ë¼ì¸ ì˜†ì— ì£¼ì„ ì¶”ê°€í•˜ë©´ ë¯¸ë™ì‘.
debezium.source.table.include.list=gyumin.orders,gyumin.users

# ì´ê±´ column.include ì˜µì…˜ìœ¼ë¡œ ì¹¼ëŸ¼ë‹¨ìœ„ cdc í•  ë•Œ ì‚¬ìš©. ì§€ê¸ˆì€ table ë‹¨ìœ„ ì „ì²´ cdc ë³´ê¸°ë•Œë¬¸ì— í•´ë‹¹ ì„¤ì •ê°’ ë¯¸í•„ìš”.
debezium.source.skip.messages.without.change=true
# binlogs nì´ˆ ì£¼ê¸°ë¡œ ì½ì–´ì™€ì„œ redis stream ì— ë°€ì–´ë„£ìŒ. 0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì˜¤ìë§ˆì ë„£ëŠ”ê±°
debezium.source.offset.flush.interval.ms=1000
# ì–´ë””ê¹Œì§€ binlog sink ë˜ì—ˆëŠ”ì§€ëŠ” redis ì— ì €ì¥í•˜ë„ë¡ í•¨
debezium.source.offset.storage=io.debezium.storage.redis.offset.RedisOffsetBackingStore
# <prefix>.<dbName>.<tableName> key ë¡œ stream ì— ìŒ“ì„
debezium.source.topic.prefix=cdc
# cdc í• ë ¤ëŠ” í…Œì´ë¸”ì˜ ddl ì´ë ¥ì„ ì €ì¥í•¨
debezium.source.schema.history.internal=io.debezium.storage.redis.history.RedisSchemaHistory
```

# ì¦ë¶„ ìŠ¤ëƒ…ìƒ·

* ì´ê±´ cdc í•  í…Œì´ë¸” ë‚˜ì¤‘ì— ì¶”ê°€í•  ë–„ ì‚¬ìš©. í•´ë‹¹ í…Œì´ë¸”ë§Œ ì´ˆê¸° rows ì½ê³  initialize í•  ë•Œ ì‚¬ìš©í•œë‹¤.
    * https://debezium.io/blog/2021/10/07/incremental-snapshots/
    * https://debezium.io/documentation/reference/stable/connectors/mysql.html#debezium-mysql-incremental-snapshots
    * íŠ¸ë¦­ì„ ì´ìš©í•˜ëŠ”ê±´ë°(ê³µì‹ì—ì„œ ì´ë ‡ê²Œ ë§í•¨) ì•„ë¬´ í…Œì´ë¸” í•˜ë‚˜ ë§Œë“¤ê³  <db>.<table> ì„ table.list ì¶”ê°€í•œ ë’¤ ì‹¤í–‰. í•´ë‹¹ í…Œì´ë¸”ì— insert ì¿¼ë¦¬ ì•„ë˜ì™€ ê°™ì´ ì „ì†¡í•˜ë©´ debezium ì´ ì´ í…Œì´ë¸” ì½ê³ ìˆë‹¤ê°€ ìŠ¤ëƒ…ìƒ· ì¿¼ë¦¬ ì¸ì§€ í›„ í…Œì´ë¸”ë“¤ì„ ì²­í¬ë‹¨ìœ„ ìŠ¤ëƒ…ìƒ· ì§„í–‰í•œë‹¤.

[reference](https://debezium.io/documentation/reference/stable/configuration/signalling.html)

```sql
# ì¦ë¶„ ìŠ¤ëƒ…ìƒ· ëª…ë ¹ìš© í…Œì´ë¸”
CREATE TABLE db_schema.dbz_signal (
  id    VARCHAR(64) PRIMARY KEY,
  type  VARCHAR(32) NOT NULL,
  data  VARCHAR(2048) NULL
);

# debezium server property ì— ìœ„ì˜ í…Œì´ë¸” ìº¡ì²˜í•˜ë„ë¡ ì„¤ì •. + ì¶”ê°€í•  í…Œì´ë¸”ë„ ë°”ë¼ë³´ê²Œ. e.g. new_schema.users 

# new_schema.users ì´ëŸ¬ì´ëŸ¬í•œ í…Œì´ë¸” ìŠ¤ëƒ…ìƒ· ê°€ì ¸ì™€ì„œ initialize í•´ë¼ë¼ê³  ëª…ë ¹í•˜ëŠ” ì¿¼ë¦¬
INSERT INTO db_schema.dbz_signal (id, type, data)
VALUES (
   'signal-1',
   'execute-snapshot',
   '{"data-collections":["new_schema.users"],"type":"incremental"}'
;
```

ì´ëŸ¬ë©´!! ìŠ¤íŠ¸ë¦¼ì´ ìƒì„±ë˜ê³  

`XLEN mysql_sink.new_schema.users` ë¡œ í¬ê¸° ë° ì‹¤ì œ í˜ì´ë¡œë“œë¥¼ í™•ì¸í•´ë³´ë©´ new_schema ì— ë“¤ì–´ìˆë˜ rows ë“¤ì´ ì „ë¶€ ìŠ¤íŠ¸ë¦¼ì— ë¡œë“œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### Mysql datetime to millis ì•Œê³ ìˆì–´ì•¼í•¨.

> reference : https://debezium.io/documentation/reference/stable/connectors/mysql.html#mysql-temporal-types
`DATETIME`Â with a value ofÂ `2018-06-20 06:37:03`Â becomesÂ `1529476623000`.

ì •ìƒë™ì‘ í™•ì¸ë˜ì—ˆìœ¼ë‹ˆ í•´ë‹¹ ê±´ ë„ì»¤ë¼ì´ì§• í›„ ì™¸ë¶€ í™˜ê²½ë³€ìˆ˜ secret ì„¸íŒ…ê³¼ pod ë¡œ ë¡œë“œí•˜ëŠ” cicd íŒŒì´í”„ë¼ì¸ ë° ëª¨ë‹ˆí„°ë§ ì„¤ì • í•„ìš”!

## CDC ì•ˆì •í™”
* redis commandTimeout > redis XGROUPREAD pollTimeout ì„¤ì •í•´ì¤˜ì•¼ ë¨. pollTimeout ì´ XGROUPREAD ë¡œ ì½ì„ ë•Œ command ëŒ€ê¸°ì‹œê°„ ì„¤ì •í•˜ëŠ”ê±´ë° ì´ ê°’ì€ redis connection ìì²´ê´€ë¦¬ commandTimeout ê°’ë³´ë‹¤ ì‘ì•„ì•¼í•œë‹¤.
* ì‹±í¬ì‹¤íŒ¨ dbms row ì¬ì²˜ë¦¬ ë¡œì§ í•„ìš”
    * ì§„ì§œ ë¬¸ì œëŠ” ë§Œì•½ ì£¼ë¬¸í…Œì´ë¸” ì‹±í¬í•  ë•Œ í•˜ë‚˜ê°€ ì‹¤íŒ¨í–ˆë‹¤ê³  ê°€ì •í•œë‹¤ë©´ ê½¤ ê¹Œë‹¤ë¡­ë‹¤. PEL ì— ë“¤ì–´ìˆëŠ” í•´ë‹¹ ì£¼ë¬¸ì„ ë‹¤ì‹œ ì‹±í¬ í•´ì£¼ì–´ì•¼í•˜ëŠ”ë° ë”± ì´ë•Œ ë§ˆì¹¨ í•´ë‹¹ ì£¼ë¬¸ì´ ì—…ë°ì´íŠ¸ë˜ë©´ PEL ì¬ì²˜ë¦¬í•  ë–„ ë®ì–´ì”Œì›Œì§„ë‹¤. A --> B --> C ë˜ì–´ì•¼í•˜ëŠ”ë°, A -x-> B ê°€ ì‹¤íŒ¨í•˜ê³ , ê·¸ ì‚¬ì´ì— C ê°€ ë“¤ì–´ì˜¤ë©´ A -> C ë¡œ ë˜ì–´ë²„ë¦°ë‹¤. ê·¸ë˜ì„œ PEL ì¬ì²˜ë¦¬í•  ë•Œ í•´ë‹¹ row ê°€ ì—…ë°ì´íŠ¸ëœê²Œ ìˆëŠ”ì§€ ì²´í¬í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•˜ë‹¤. ë§Œì•½ í•´ë‹¹ row ê°€ ì—…ë°ì´íŠ¸ ë˜ì—ˆë‹¤ë©´ ì¬ì²˜ë¦¬í•  ë–„ ë¬´ì‹œí•œë‹¤(ì´ë¯¸ ìµœì‹ ì˜ ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆê¸° ë•Œë¬¸). ì´ë–„ row delete ëœ ê²½ìš°ë¥¼ ìƒê°í•´ì•¼í•œë‹¤. row ê°€ ì‚­ì œë˜ë©´ ì–¸ì œ ì‚­ì œë˜ì—ˆëŠ”ì§€ ì‹œê°„ì„ ë”°ë¡œ ë‚¨ê²¨ì„œ ì¬ì²˜ë¦¬ ë©”ì„¸ì§€ ì‹œê°„ì´ë‘ ë¹„êµí•´ì„œ ìš°ì„ ê¶Œì´ ìˆëŠ” ë©”ì„¸ì§€ë¥¼ ì ìš©í•´ì•¼í•˜ëŠ”ë° ì´ ë¶€ë¶„ì€ ìš°ë¦¬ ê¸°ë³¸ì •ì±…ì´ ì†Œí”„íŠ¸ delete ë¼ í¬ê²Œ ì‹ ê²½ì•ˆì¨ë„ ë  ë“¯! ì¢…í•©í•˜ë©´ row ì—…ë°ì´íŠ¸ ì‹œê°„ì„ ë³´ê³  ì¬ì²˜ë¦¬ ë©”ì„¸ì§€ ì‹œê°„ë³´ë‹¤ ìµœì‹ ì´ë©´ ì¬ì²˜ë¦¬ ë¬´ì‹œ, ì•„ë‹ˆë©´ ì¬ì²˜ë¦¬ ì§„í–‰í•œë‹¤.

# êµ¬í˜„í•œ Sink (CDC + ETL) ë°ì´í„° ì ì¬ ëª¨ë“ˆ ê´€ë ¨ ë‚´ìš©ì •ë¦¬

 DB(MySQL) ë³€ê²½ì„ Debezium CDC ë¡œ Redis stream ì ì¬ ë° stream key êµ¬ë…/ìˆ˜ì‹ í•˜ì—¬ MongoDB ë„ë©”ì¸ ë¬¸ì„œë¡œ ì ì¬í•˜ëŠ” ëª¨ë“ˆì— ëŒ€í•œ ì„¤ëª….

í…Œì´ë¸” ë‹¨ìœ„ë¡œ ì»¤ë„¥í„°ë¥¼ ì¶”ê°€í•´ mysql í…Œì´ë¸”ì„ mongodb ë„ë©”ì¸ ë¬¸ì„œë¡œ ë§¤í•‘/ì ì¬í•˜ëŠ” êµ¬ì¡°.

## ì „ì²´ íë¦„

### **CDC, ETL ëª¨ë“ˆ ë°°í¬**

git actions ê¸°ì¡´ í”„ë Œì°¨ì´ì¦ˆ ë³„ ìˆ˜ë™ë°°í¬ì— ê³µí†µëª¨ë“ˆ ë°°í¬í•˜ëŠ” ë°©ì‹ ì¶”ê°€ í›„ ê°œë³„ ëª¨ë“ˆ(debezium, sink module) CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•. ì£¼ìš” íŒŒë¼ë¯¸í„°(db, redis, mongo, quarkus params, etc.) ëŠ” deploy.yaml ì— envset ìœ¼ë¡œ linux ë¡œì»¬ export env ê°€ ì¹˜í™˜ë˜ì–´ ì£¼ì…í•˜ë„ë¡ ì„¤ì •.

![data](../2025-09-06-02-24-54.png)

### **Debezium Server CDC**

Debezium Server ê°€ MySQL binlog ë¥¼ ì½ì–´ ë³€ê²½ ì´ë²¤íŠ¸ë¥¼ JSON payloadë¡œ redis stream ì— ì „ì†¡

### **ETL ëª¨ë“ˆ**

1) Row ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜
- ìœ„ì¹˜: order-hub-sink/src/main/kotlin/.../connector/<domain>/
- Debezium after/before ìŠ¤ëƒ…ìƒ·ì„ ê·¸ëŒ€ë¡œ ë‹´ëŠ” ìš©ë„
- ê°€ëŠ¥í•œ null í—ˆìš©ìœ¼ë¡œ ì„ ì–¸(ddl ì¹¼ëŸ¼ nullable ë¡œ ë³€ê²½ë  ìˆ˜ë„ ìˆì–´ì„œ)

2) Mongo ë„ë©”ì¸ ë¬¸ì„œ ì •ì˜(E : SinkClass)
- ìœ„ì¹˜: order-hub/src/main/kotlin/.../domain/sink/<domain>/
- sinkInfo(mysqlId, franchiseCode, sinkedAt) í¬í•¨
- ì •ê·œí™” í’€ë ¤ë©´ upsert, toEntity êµ¬ì¡° ë¦¬ëª¨ë¸ë§

3) ì‹±í¬ ì»¤ë„¥í„° êµ¬í˜„
- @Component class XxxSinkConnector(mongoTemplate: MongoTemplate)
- SinkConnector<{Row}, {Entity}> ìƒì†(ì´ ë•Œ Row ëŠ” mysql í…Œì´ë¸” ì½ëŠ” ì¤‘ê°„ í´ë˜ìŠ¤, Entity ëŠ” mongodb @Document)
- typeRef: TypeReference<DebeziumMessage<Row>>() êµ¬í˜„
- mysqlTableName ê³¼ collectionName ì§€ì •
- toEntity(row, franchise)ì—ì„œ ë§¤í•‘ ì‘ì„±
- keyQuery(row, franchise)ì—ì„œ upsert/remove í‚¤ ì‘ì„±
- ì°¸ê³ : ë‹¨ìˆœ í…Œì´ë¸”ì€ findAndReplace(upsert)ë¡œ ì¶©ë¶„. ë¬¸ì„œ ë‚´ë¶€ ë³„ë„ë¡œ ë¹„ì •ê·œí™”í•œ ì•„ì´í…œ ë°°ì—´ì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°(ì˜ˆ: order_items)ì—ëŠ” ì•ˆì „í•œ í•„ë“œ ë‹¨ìœ„ .set ì‚¬ìš©ì„ ê³ ë ¤

- SinkConnector<T, E : SinkClass>
  - handle(): DebeziumMessage íŒŒì‹±, op(c/r/u/d) ì— ë”°ë¼ upsert/remove ìˆ˜í–‰
  - toEntity(row, franchise): Row -> Mongo ë„ë©”ì¸ ë¬¸ì„œ ë³€í™˜
  - keyQuery(row, franchise): upsert/remove í‚¤ ì¿¼ë¦¬ ì‘ì„±(ë³´í†µ sinkInfo.mysqlId + sinkInfo.franchiseCode)
  - mysqlTableName: ë‹´ë‹¹ MySQL í…Œì´ë¸”ëª… (ex. "orders", "order_items")
  - collectionName: ëŒ€ìƒ Mongo ì»¬ë ‰ì…˜ëª… (ex. "sink_orders")
- SinkConnectorFinder: mysqlTableName ê¸°ì¤€ìœ¼ë¡œ ì ì ˆí•œ ì»¤ë„¥í„° ì„ íƒ

4) ë¼ìš°íŒ… ë“±ë¡
- @Component ë§Œ ë‹¬ë©´ SinkConnectorFinder ê°€ ìë™ ìˆ˜ì§‘í•˜ì—¬ mysqlTableName ìœ¼ë¡œ ë¼ìš°íŒ…

5) í…ŒìŠ¤íŠ¸ ì‘ì„±
- Kotest StringSpec + Testcontainers(MongoDB)
- DebeziumMessage ë˜í¼ë¥¼ ì§ì ‘ ìƒì„±í•´ c/u/d ì¼€ì´ìŠ¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜
- ë©€í‹° í”„ëœì°¨ì´ì¦ˆ(FranchiseCode) ê²©ë¦¬, ë°°ì—´ ì¶”ê°€/ê°±ì‹ /ì‚­ì œ, Null/ê·¹ë‹¨ê°’ ë“± ì—£ì§€ ì¼€ì´ìŠ¤ ê²€ì¦

6) Order Hub Sink ëª¨ë“ˆì´ SinkBindingsConfig ì—ì„œ ì„¤ì •í•œ redis stream êµ¬ë…, ë©”ì‹œì§€ ìˆ˜ì‹ 
7) Debezium JSONì„ íŒŒì‹±í•˜ì—¬ í…Œì´ë¸”ë³„ SinkConnector ë¡œ ë¼ìš°íŒ…
8) ê° ì»¤ë„¥í„°ê°€ Row(í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ) -> ë„ë©”ì¸ Sink ë¬¸ì„œë¡œ ë§¤í•‘í•˜ê³  MongoDBì— upsert/remove ìˆ˜í–‰
9) franchiseCode + mysqlId ë¥¼ ë¬¸ì„œì˜ sinkInfo ì— ë³´ê´€. ë™ì¼í•œ mysqlId ë¼ë„ ê°€ë§¹ë³„ë¡œ ê²©ë¦¬ ì €ì¥ë˜ì–´ìˆìŒ.

# **í•˜ë‹¤ë³´ë‹ˆ ìƒê¸´ ì¤‘ìš”í•œ ì´ìŠˆ ë° íŒ**
1. redis stream ì— ë©”ì‹œì§€ ì ì¬í•˜ëŠ” ì†ë„ë³´ë‹¤ sink ì²˜ë¦¬ ì†ë„ê°€ ëŠë ¤ì„œ ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ OOM ë°œìƒí•¨. ê·¸ë˜ì„œ sink ì‹œ binlog -> redis stream ì ì¬ ìœ ëŸ‰ì œì–´ í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì´ê±° ì„¤ì •í•  ë• `redis-cli CONFIG SET maxmemory 4096mb` ë¡œ redis ì„œë²„ì˜ max memory limit ë¨¼ì € 1ì°¨ ì„¤ì •í•´ì£¼ê³  ë‚œ ë’¤ ì ìš©í•˜ë‹ˆê¹Œ ì˜ë¨. ê·¸ëƒ¥ ê¸°ì¡´ 0 (unlimited) ìƒíƒœì—ì„œ ì´ ì˜µì…˜ë§Œ ì£¼ë©´ ì œëŒ€ë¡œ ì ìš©ì´ ì•ˆë¨. (ê´€ë ¨ ê³µì‹ ë ˆí¼ëŸ°ìŠ¤ë‚˜ ì˜¬ë¼ì˜¨ ì´ìŠˆ ì°¾ì•„ë´ë„ ì—†ì–´ì„œ ë‚´ ì¶”ì¸¡ìœ¼ë¡œëŠ” redis maxmemory unlimited 0 ìƒíƒœì—ì„œëŠ” debezium server limit ì˜µì…˜ì´ ë¬´ì‹œë˜ëŠ” ê²ƒ ê°™ìŒ.) maxmemory-policy ëŠ” noeviction ìœ¼ë¡œ ì„¤ì •í•´ë‘ì—ˆìŒ.
    * `debezium.sink.redis.memory.limit.mb=512` (512MB ë¡œ ì œí•œ)
    * `debezium.sink.redis.memory.threshold.percentage=85` (85% ë„ë‹¬ ì‹œì ë¶€í„° ìœ ëŸ‰ì œì–´ ì‹œì‘)

>  * debezium.sink.redis.memory.limit.mb=${DBZ_REDIS_MEMORY_LIMIT_MB:512}
>  * debezium.sink.redis.memory.threshold.percentage=85 [reference](https://debezium.io/documentation/reference/stable/operations/debezium-server.html?utm_source=chatgpt.com#redis-memory-threshold-percentage)

ì•„ë˜ë³´ë©´ ì„¤ì •ì´ì „ì—ëŠ” ë©”ëª¨ë¦¬ 4G ì°ê³  key ì œê±°. ì„¤ì •ì´í›„ 512 / 85% ë¡œ ì œí•œë˜ë‹ˆê¹Œ ë©”ëª¨ë¦¬ 400 ëŒ€ ì–¸ë”ë¡œ ìœ ì§€ë˜ëŠ”ê±° í™•ì¸.

![a](../2025-09-26-02-48-29.png)

2. ì–´ë–¤ stream ì„ ì½ì„ ì§€ ë¯¸ë¦¬ í•˜ë“œì½”ë”©í•´ì„œ ì„¸íŒ…í•´ë†“ê¸°ë³´ë‹¨ íŠ¹ì • prefix( mysql_sink.* ) ë¡œ ì‹œì‘í•˜ëŠ” stream ì„ ë™ì ìœ¼ë¡œ ì—°ê²°í•´ì„œ ì½ë„ë¡ ì„¤ì •í•˜ëŠ”ê²Œ ìš´ì˜ì— í›¨ì”¬ ìœ ë¦¬í•¨. ê·¸ë˜ì„œ ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ë§¤ ì´ˆë§ˆë‹¤ stream key ëª©ë¡ì„ ì¡°íšŒí•´ì„œ ì½ë„ë¡ ì„¤ì •. ë˜ stream read ì»¤ë„¥ì…˜ ë§ºì„ í•„ìš” ì—†ìœ¼ë‹ˆê¹Œ ì¸ë©”ëª¨ë¦¬ ë¦¬ìŠ¤íŠ¸ë¡œ ê´€ë¦¬.
3. stream ì— ì ì¬ëœ mysql ë°ì´í„°ë¥¼ ì½ëŠ”ê±´ ê¸°ì¡´ì— ë²Œí¬ë¡œ ì½ê³  ìˆì—ˆì§€ë§Œ ê²°êµ­ ì½ì–´ì™€ì„œ mongodb upsert ë¥¼ í•˜ë‚˜ì”© íˆê³ ìˆì—ˆê³  ê½¤ ë³‘ëª©ì´ì˜€ìŒ. ë‹¨ê±´ì²˜ë¦¬ ë¬¼ë¡  ì†ë„ëŠ” n ms ì´ë‚´ ì´ì§€ë§Œ ì´ê²Œ ëˆ„ì ë˜ë©´ ê½¤ ì»¤ì§€ê¸° ë•Œë¬¸ì— ê²°êµ­ ë³‘ëª©ì´ì˜€ìŒ. ë˜í•œ ê°œë³„ ë©”ì„¸ì§€ ack, delete, pending ê´€ë¦¬ë˜í•œ ì˜¤ë²„í—¤ë“œë¼ ì „ì²´ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ì²­í¬ë‹¨ìœ„ì²˜ë¦¬ê°€ í•„ìš”í–ˆë‹¤. stream -> 100 read -> buffer ì ì¬ -> 100ê°œ ì°¨ë©´ bullk mongodb flush() & redis bulk ack, delete. í•˜ë„ë¡ ìˆ˜í–‰. 100ê°œ ë‹¤ ì•ˆì°¨ë„ 1ì´ˆì— í•œë²ˆì”© flush() í•˜ë„ë¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì¶”ê°€. ì´ëŸ¬ë‹ˆê¹Œ í›¨ì”¬ ì•ˆì •ì ì´ê³  ë¹ ë¦„. ê¸°ì¡´ì—” ë‹¨ê±´ ë©”ì„¸ì§€ ì²˜ë¦¬ì— 1.3 ~ 1.5 ms ì†Œìš”ë¬ëŠ”ë° ì•½ 100ê°œì²˜ë¦¬ì— í‰ê·  27ms ì •ë„ë‹ˆê¹Œ ì•½ 0.27 ms ê±°ì˜ **5ë°° ë¹¨ë¼ì§**. ëª©í‘œëŠ” ë„¤íŠ¸ì›Œí¬ ë¼ìš´ë“œ íŠ¸ë¦½ ë¹„ìš© ì¤„ì—ˆê¸°ì˜€ê³  ê²°ê³¼ëŠ” ì˜ˆìƒí•œ ëŒ€ë¡œ ë‚˜ì™”ë‹¤. ì•„ë˜ëŠ” AOP ë¶™ì—¬ì„œ bulkHandle() ë©”ì„œë“œ ì‹¤í–‰ì‹œê°„ ì°ì€ ë¡œê·¸.

```
2025-09-26T02:48:01.890+09:00  INFO 96441 --- [fooddash-domain] [    virtual-246] [\] c.f.o.connector.SinkConnector            : bulkHandle called with 100 records for table menus
SinkConnector.bulkHandle(..) ì‹¤í–‰ ì‹œê°„: 26.672 ms
2025-09-26T02:48:01.926+09:00  INFO 96441 --- [fooddash-domain] [MessageBroker-2] [\] c.f.o.connector.SinkConnector            : bulkHandle called with 12 records for table menus
SinkConnector.bulkHandle(..) ì‹¤í–‰ ì‹œê°„: 4.947 ms
2025-09-26T02:48:01.984+09:00  INFO 96441 --- [fooddash-domain] [    virtual-246] [\] c.f.o.connector.SinkConnector            : bulkHandle called with 100 records for table menus
SinkConnector.bulkHandle(..) ì‹¤í–‰ ì‹œê°„: 26.582 ms
2025-09-26T02:48:02.027+09:00  INFO 96441 --- [fooddash-domain] [MessageBroker-8] [\] c.f.o.connector.SinkConnector            : bulkHandle called with 25 records for table menus
SinkConnector.bulkHandle(..) ì‹¤í–‰ ì‹œê°„: 7.496 ms
2025-09-26T02:48:02.079+09:00  INFO 96441 --- [fooddash-domain] [    virtual-246] [\] c.f.o.connector.SinkConnector            : bulkHandle called with 100 records for table menus
SinkConnector.bulkHandle(..) ì‹¤í–‰ ì‹œê°„: 27.653 ms
2025-09-26T02:48:02.127+09:00  INFO 96441 --- [fooddash-domain] [MessageBroker-8] [\] c.f.o.connector.SinkConnector            : bulkHandle called with 1 records for table menus
SinkConnector.bulkHandle(..) ì‹¤í–‰ ì‹œê°„: 1.658 ms
```

* ì¢…í•©í•˜ë©´ ë©”ëª¨ë¦¬ ê¸°ë°˜ì´ê¸°ë•Œë¬¸ì— ë°ì´í„° ìœ ì‹¤ì´ ìˆì„ ìˆ˜ ìˆìŒ. ìœ ì‹¤ ìµœì†Œí™”í•˜ê¸°ìœ„í•´ noeviction ì •ì±… ì„¤ì • ë° mysql->redis ìœ ëŸ‰ì œì–´ ì„¤ì •. history ë° offset redis ì— ê¸°ë¡ë˜ì–´ ì €ì¥ë˜ê¸°ë•Œë¬¸ì— debezium server ì¬ì‹œì‘ì‹œì ë¶€í„° ë‹¤ì‹œ cdc ê°€ëŠ¥. ì§„ì§œ ë§Œì•½ì— ì´ binlog ì–´ë””ê¹Œì§€ ì½ì—ˆëŠ”ì§€ offset ë§ˆì € ë‚ ë¼ê°€ë„ ì²˜ìŒë¶€í„° ìŠ¤ëƒ…ìƒ·í•´ë„ ë¨. redis -> mongodb ì— ë©±ë“±ì„±ì´ ë³´ì¥ë˜ê¸° ë•Œë¬¸ì—.(ë§Œì•½ sink ëœ ë¬¸ì„œì˜ ìˆ˜ì •ì´ ìˆë‹¤ë©´ ìˆ˜ì •ë¨=true ë¡œ í•´ë†“ê³  ETL ëª¨ë“ˆì—ì„œ upsert í•  ë•Œ true ë©´ ì—…ë°ì´íŠ¸ ì•ˆí•˜ë„ë¡ ì²˜ë¦¬í•˜ë“  ì•„ë‹ˆë©´ ë”°ë¡œ read ì „ìš© sink ë¬¸ì„œë¡œ ê´€ë¦¬í•˜ë“  ë°ì´í„° ìš´ì˜ì •ì±…ì— ë§ê²Œ ì²˜ë¦¬í•˜ë©´ ë¨.)

# **Appendix**

### ìƒˆë¡œìš´ í…Œì´ë¸” ì¶”ê°€ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- Row ë°ì´í„° í´ë˜ìŠ¤ ìƒì„± (snake_case, null í—ˆìš©, BigDecimal/OffsetDateTime ë“±)
- ë„ë©”ì¸ ë¬¸ì„œ(SinkClass ë¥¼ ìƒì†ë°›ëŠ”) ìƒì„±
- ~~ì‹±í¬ì»¤ë„¥í„° êµ¬í˜„ ë° SinkBindingsConfig ì— @Bean ë“±ë¡~~ ì´ê±° ë‹¤ì´ë‚˜ë¯¹í•˜ê²Œ sink_mysql.* prefix ë¡œ ì‹œì‘í•˜ëŠ” stream ì„ ì½ë„ë¡ ë³€ê²½í•´ì„œ ìœ ì§€ë³´ìˆ˜ í¸í•˜ê²Œ í•´ë†“ìŒ.
- ë¹„ì •ê·œí™” í•„ìš” ì‹œ OrderItem ì°¸ì¡°(ê°œë³„ upsert, toEntity).
- Kotest + Testcontainers í…ŒìŠ¤íŠ¸ ì‘ì„± (c/u/d, ë©€í‹° í”„ëœì°¨ì´ì¦ˆ, ì—£ì§€ ì¼€ì´ìŠ¤)
- Debezium ìŠ¤ëƒ…ìƒ·/ì‹œê·¸ë„ ì „ëµ ê²€í† .(í•´ë‹¹ í…Œì´ë¸” ê¸°ì¡´ row ìŠ¤ëƒ…ìƒ· need? or not)
    - ë§Œì•½ need í•˜ë©´ ìœ„ ì¦ë¶„ ìŠ¤ëƒ…ìƒ· ì „ëµ ì°¸ê³ 

* Debezium server application.properties ì•Œì•„ë†“ìœ¼ë©´ ì¢‹ì€ ê·œì¹™ë“¤
  * line ëì— ì£¼ì„ë‹¬ë©´ Regex ì˜¤ë¥˜ë‚¨.
  * big decimal ì€ debezium.source.decimal.handling.mode=string ìœ¼ë¡œ ì„¤ì •í•´ì•¼ì§€ ì •í™•íˆ ì½ì–´ì˜´.
  * setup each table as <SCHEMA_NAME>.<TABLE_NAME>
  * Debezium Server ì„¤ì •ì— ë§ì¶° execute-snapshot ë“± ì‹œê·¸ë„ì„ ì‚¬ìš©í•´ íŠ¹ì • í…Œì´ë¸” ìŠ¤ëƒ…ìƒ· ìˆ˜í–‰ ê°€ëŠ¥

### datetime debezium ë‚´ ë³€í™˜

 debezium server ì€ mysql ì‹œê°„ ì¹¼ëŸ¼ íƒ€ì…ì— ë”°ë¼ micro, milli, second ë“± ë‹¤ë¥´ê²Œ ë¡œë”©í•¨.

![ã…](../2025-09-13-18-14-25.png)

íŒ€ ë‚´ì—ì„œ datetime(2), datetime, timestamp ë“± ë‹¤ì–‘í•œ ì‹œê°„ íƒ€ì…ì„ ì“°ê³ ìˆì–´ì„œ debezium adaptive_seconds ëª¨ë“œë¡œ ë³€í™˜ì ì¬í–ˆì„ ë•Œ ì´ê²Œ micro, milli, second ì¤‘ ë­”ì§€ ëª¨ë¥´ëŠ” ë¬¸ì œê°€ ìˆìŒ. ë¬¼ë¡  ê¸°ì¡´ ddl ì¹¼ëŸ¼ íƒ€ì…ì„ ë³´ë©´ ì´ê²Œ ë­”ì§€ ì•Œ ìˆ˜ ìˆì§€ë§Œ ê·€ì°®ìŒ. 2280 ë…„ê¹Œì§€ëŠ”(ì •í™•íˆëŠ” 2286-11-20 17:46:40 UTC) ë¬¸ì œì—†ëŠ” ë°©ë²•ì´ ìˆëŠ”ë° ê·¸ê²Œ 10ìë¦¬ ì´í•˜ëŠ” second, 11~13ìë¦¬ milli, 14~16ìë¦¬ micro ë¡œ êµ¬ë¶„í•˜ëŠ” ë°©ë²•ì„. 1970ë…„ ì´ì „ì€ ë§ˆì´ë„ˆìŠ¤ í‘œê¸´ë° ì´ê²ƒë„ ë³€í™˜ ê°€ëŠ¥í•¨. ì–˜ë„ ê²½ê³„ê°’ì´ ì´ˆ ë‹¨ìœ„ê°€ 1~10ìë¦¬ ì ìš©ë˜ëŠ” ë²”ìœ„ê°€ 1653(1653-03-05 23:46:40 UTC)ë…„ë„ì¸ë° ì‚¬ì‹¤ ì •ë§ ê³¼ê±°ì˜ ì •ë³´ë¥¼ ê°€ì§€ê³ ìˆì–´ì•¼í•œë‹¤ëŠ” ìš”êµ¬ì‚¬í•­ì´ ì—†ë‹¤ë©´(db ì— ì´ ê°’ì„ ì €ì¥í•˜ê³ ì‹¶ë‹¤ê°€ ì•„ë‹ˆë©´) ë§ˆì´ë„ˆìŠ¤ë„ ë§ˆì°¬ê°€ì§€ë¡œ abs í•´ì„œ ì ìš©í•˜ë©´ ë¨.

> ê·¼ë° ì •ë§ ìš°ë¦¬ëŠ” 2280ë…„ ì´í›„ ê°’ì„ ì“°ì§€ì•Šë‚˜? ë‹¤ì‹œ ë³´ë‹ˆê¹Œ `9999ë…„ 12ì›” 31ì¼` ê°’ì„ ì“°ê³  ìˆìŒ. ê·¸ë˜ì„œ ê·¸ëƒ¥ `time.precision.mode=connect` ë¡œ ì„¤ì •í•˜ê³  ëª¨ë“  íƒ€ì„ ì¹¼ëŸ¼ íƒ€ì… datetime(m) ìœ¼ë¡œ ë‹¤ í†µì¼í•œ ë’¤ debezium ì´ milliseconds ë¡œ ì¼ê´„ì„¤ì •í•˜ë„ë¡ ìœ ë„í•˜ëŠ”ê²Œ ì¢‹ì„ë“¯. ê·¸ëŸ¬ë©´ ê·¸ëƒ¥ Long íƒ€ì… ì˜¤ë©´ ìƒê°ì•ˆí•˜ê³  milliseconds íŒë‹¨ í›„ ë³€í™˜í•´ì£¼ë©´ ë¨. (ì°¸ê³ ë¡œ postgresql ì¼ê´„ microsecond ì„¤ì •ê°™ì€ê±° ê°€ëŠ¥í•¨. mysql ì€ ë…¸ê°€ë‹¤ ã…œ)

## ë³¸ ëª¨ë“ˆì— ì •ì˜í•œ Rules
* sinkedAt ì€ binlog event ë°œìƒì‹œì ì´ë©°, ë³¸ ëª¨ë“ˆì—ì„œëŠ” ê¸°ì¡´ ë¬¸ì„œì˜ sinkedAt ë³´ë‹¤ ë¹ ë¥¸ sinkedAt ì´ ë„ì°©í•˜ë©´ ê·¸ëŒ€ë¡œ sink í•¨. ì´ìœ ëŠ” select ì¿¼ë¦¬ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì„ ì¤„ì´ê¸° ìœ„í•¨.
* sink ì‹¤íŒ¨ê±´ì€ 1íšŒì— í•œí•´ ì¬ì‹œë„í•¨. ì´í›„ ì„±ê³µì—¬ë¶€ ê´€ê³„ì—†ì´ pending & stream ì—ì„œ ì œê±°. ì´í›„ ì •í™•í•œ ë°ì´í„°ê°€ í•„ìš”í•  ì‹œ ì¬ì²˜ë¦¬ ì „ëµ ë³€ê²½ í•„ìš”.
* sink ì„±ê³µí•˜ë©´ stream ì—ì„œ ì œê±°í•˜ì—¬ ë©”ëª¨ë¦¬ í™•ë³´í•¨.
* ex) Order ë¬¸ì„œì— OrderItem ì„ í¬í•¨í•˜ë„ë¡ ë¹„ì •ê·œí™” ì‹œ Order ë³´ë‹¤ OrderItem ì´ ë¨¼ì € ìƒê¸¸ ìˆ˜ ìˆìŒ. ì´ë¥¼ ê³ ë ¤í•´ì•¼í•¨.
* Row ë°ì´í„° í´ë˜ìŠ¤ëŠ” ìµœëŒ€í•œ null í—ˆìš©ìœ¼ë¡œ ì„ ì–¸í•˜ì—¬ ì´í›„ RDBMS DDL ë³€ê²½ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘.

