---
layout: default
title: Spring ì¡ë™ì‚¬ë‹ˆ
date: 2024-05-17
parent: ğŸ“Œ Server
nav_order: 15
---

created at 2024-05-17
{: .label .label-yellow }

{: .no_toc .text-delta }

1. TOC
{:toc}

## Spring Proxy

* Proxy = ëŒ€ë¦¬ì
* Spring ì—ì„œ í”„ë¡ì‹œëŠ” ë§¤ìš° ë§ì€ ê³³ì—ì„œ ì‚¬ìš©
  * AOP ë¡œ ë¡œì§ ê°ì‹¸ì„œ ì²˜ë¦¬í•œëŠ” ë¶€ë¶„.
  * Lazy Initialization
  * Security
  * Transaction Management
  * ë“±ë“±

ì˜ˆë¥¼ ë“¤ì–´ì„œ ì´ëŸ°ì‹ì„.

```kotlin
class UserService(
    private val userRepository: UserRepository
) {
    fun save(user: User) {
        userRepository.save(user)
    }
}
```

UserRepository ê°€ interface ë¼ë©´, UserService ëŠ” Proxy ê°ì²´ê°€ ë§¤í•‘. ê·¸ë¦¬ê³  ì´ í”„ë¡ì‹œ ê°ì²´ëŠ” UserRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì™€ ì—°ê²°ë¨. ì¦‰, `interface` -> `proxy` -> `impl class ê°ì²´` ì´ëŸ°ì‹ìœ¼ë¡œ ë§¤í•‘ì‹œì¼œì£¼ëŠ” ë…€ì„ì´ Proxy ì„.

ê·¸ë¦¬ê³  ì´ëŸ° ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œí•œ í”„ë¡ì‹œ êµ¬í˜„ë°©ì‹ì„ **JDK Dynamic Proxy** ë¼ê³  í•¨. í´ë˜ìŠ¤ ê¸°ë°˜ì˜ ë°©ì‹ì¸ CGLIB ë„ ìˆìŒ.

1.	JDK Dynamic Proxy
* ì„¤ì •: proxyTargetClass = false ë˜ëŠ” **ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì€ ê²½ìš° ìë™ìœ¼ë¡œ ì‚¬ìš©**
* ì‘ë™ ë°©ì‹: ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•„ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤.

2. CGLIB Proxy
* ì„¤ì •: proxyTargetClass = true
* ì‘ë™ ë°©ì‹: **ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±**í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì¸í„°í˜ì´ìŠ¤ê°€ ì—†ëŠ” í´ë˜ìŠ¤ë„ í”„ë¡ì‹œë¥¼ í†µí•´ DI ë° AOP ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* interface -> abstract class -> impl class

nGrinder ëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ êµ¬ì¡°ë¥¼ ì¡ê³  ì„¤ê³„ë˜ì–´ ìˆìŒ. ì¢€ ë” ìœ ì—°í•˜ê³  ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ì£ .



ì¢€ ë” ìœ ì—°í•˜ê³  ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ì£ . ê·¸ë˜ì„œ ì €ë„ ì´ëŸ°ì‹ìœ¼ë¡œ êµ¬ì¡°ì¡ê³  ì§„í–‰í–ˆë”ë‹ˆ! ì‹¤ì œ ê°ì²´ê°€ ë§¤í•‘ë˜ì§€ ì•Šê³  í”„ë¡ì‹œ ê°ì²´ê°€ ë§¤í•‘ë˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ Spring ì´ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§¤í•‘í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

`interface -> abstract class -> @Service extended class` ì´ëŸ° ê²½ìš°ì—ëŠ” CGLIB Proxy ê°€ ì‚¬ìš©ë˜ì–´ì•¼í•˜ì£ 


í•˜ì§€ë§Œ, spring ì—ì„œëŠ” interface ë¥¼ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ì˜ êµ¬í˜„ì²´ì™€ í”„ë¡ì‹œê°€ ë§¤í•‘ë©ë‹ˆë‹¤.

```java
@Service
public class UserServiceImpl implements UserService {
    @Override
    public void save(User user) {
        System.out.println("save user");
    }
}
```


# ì‹±ê¸€í†¤ init ìˆœì„œ

```
@Component
class Example(
    private val apiKey: String = "adsdas" // (1) ì£¼ ìƒì„±ì í˜¸ì¶œ
) {
    private val field1 = createField1()
    // (4) í”„ë¡œí¼í‹° ì´ˆê¸°í™”: ìƒì„±ì ë³¸ë¬¸ë³´ë‹¤ ë¨¼ì €, initë³´ë‹¤ ë¨¼ì €

    private fun createField1(): String {
        println("(4) property initializer ì‹¤í–‰ë¨: createField1() í˜¸ì¶œë¨")
        return "field1-value"
    }

    init {
        println("(5) init ë¸”ë¡ ì‹¤í–‰")
    }

    constructor(apiKey: String, option: Int) : this(apiKey) {
        println("(6) ë³´ì¡° ìƒì„±ì ë³¸ë¬¸ ì‹¤í–‰ (secondary constructor)")
    }

    @PostConstruct
    fun post() {
        println("(8) PostConstruct ì‹¤í–‰")
    }
}
```