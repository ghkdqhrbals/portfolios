---
layout: default
title: 7. ÏàòÏ†ïÎêú ÏïÑÌÇ§ÌÖçÏ≤ò
parent: üìå Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖÏÑúÎ≤Ñ ÌîÑÎ°úÏ†ùÌä∏
date: 2022-12-30
nav_order: 7
---

created at 2022-12-30
{: .label .label-yellow }

## ÏßÑÌñâÏÉÅÌô©
### Architecture
![img](../../../assets/img/kafka/implement.png)
ÌòÑÏû¨ Íµ¨ÌòÑÎêú ÏÑúÎπÑÏä§Î•º docker composeÎ•º ÌÜµÌï¥ Ïã§ÌñâÏãúÌÇ§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ Ïª®ÌÖåÏù¥ÎÑàÎì§Ïù¥ ÏÉùÍ∏¥Îã§.
> KafkaÏôÄ Chat Server, Auth Server, DBÎì§ Î™®Îëê Ïô∏Î∂ÄÏ†ëÏÜç Í∞ÄÎä•ÌïòÎèÑÎ°ù ÎÖ∏Ï∂ú portÎ•º ÎèÑÏª§ ÎÇ¥Î∂Ä Ìè¨Ìä∏Îûë Í∞ôÍ≤å ÏÑ§Ï†ïÌñàÎã§.
```
gyuminhwangbo@Gyuminui-MacBookPro spring-chatting-server % docker ps
CONTAINER ID   IMAGE                                      COMMAND                  CREATED          STATUS          PORTS                              NAMES
d54365955efa   spring-chatting-server_nginx               "/docker-entrypoint.‚Ä¶"   51 seconds ago   Up 47 seconds   0.0.0.0:8080->80/tcp               nginx
af5c00d411db   spring-chatting-server_chatting-server-2   "java -jar app.jar"      51 seconds ago   Up 48 seconds   0.0.0.0:8084->8084/tcp             chatting-server-2
becb35e0bc1f   spring-chatting-server_chatting-server-1   "java -jar app.jar"      51 seconds ago   Up 48 seconds   0.0.0.0:8083->8083/tcp             chatting-server-1
9bfb2b8d53ca   confluentinc/cp-kafka:7.2.1                "/etc/confluent/dock‚Ä¶"   51 seconds ago   Up 49 seconds   0.0.0.0:8099->8099/tcp, 9092/tcp   kafka3
cc8d6c5944b3   confluentinc/cp-kafka:7.2.1                "/etc/confluent/dock‚Ä¶"   51 seconds ago   Up 49 seconds   0.0.0.0:8097->8097/tcp, 9092/tcp   kafka1
995e41051907   confluentinc/cp-kafka:7.2.1                "/etc/confluent/dock‚Ä¶"   51 seconds ago   Up 49 seconds   0.0.0.0:8098->8098/tcp, 9092/tcp   kafka2
7d355211b1ce   spring-chatting-server_auth-server         "java -jar app.jar"      51 seconds ago   Up 49 seconds   0.0.0.0:8085->8085/tcp             auth-server
29ab743b9847   confluentinc/cp-zookeeper:7.2.1            "/etc/confluent/dock‚Ä¶"   52 seconds ago   Up 50 seconds   2181/tcp, 2888/tcp, 3888/tcp       zookeeper
722bf2b27df5   postgres:12-alpine                         "docker-entrypoint.s‚Ä¶"   52 seconds ago   Up 50 seconds   5432/tcp, 0.0.0.0:5434->5434/tcp   chatting-db-2
ccc3e138004a   postgres:12-alpine                         "docker-entrypoint.s‚Ä¶"   52 seconds ago   Up 50 seconds   5432/tcp, 0.0.0.0:5433->5433/tcp   chatting-db-1
3a52283f6f52   postgres:12-alpine                         "docker-entrypoint.s‚Ä¶"   52 seconds ago   Up 50 seconds   5432/tcp, 0.0.0.0:5435->5435/tcp   auth-db
```

### Íµ¨ÌòÑ ÏôÑÎ£å
* API GATEWAY
  * Ï±ÑÌåÖÏÑúÎ≤Ñ(/chat)Ïóê Ï†ëÏÜç Ïãú, ip_hashÎ°ú ÌäπÏ†ï ÏÑúÎ≤ÑÎ°úÎßå Îì§Ïñ¥Í∞ÄÎèÑÎ°ù Íµ¨ÌòÑ
  * Ïù∏Ï¶ùÏÑúÎ≤Ñ(/user)Ïóê Ï†ëÏÜçÌï† Îïå uri Îß® Îí§ `/`Í∞Ä Î∂ôÏñ¥ÏïºÎßå Ï†ëÏÜçÎêòÏóàÏóàÎã§. Í∑∏ÎûòÏÑú `rewrite {regex}`Î°ú Îß®Îí§Ïóê ÏûêÎèôÏúºÎ°ú `/`Î•º Î∂ôÏó¨Ï£ºÎèÑÎ°ù ÏÑ§Ï†ï
* Auth Server
  * Ïù∏Ï¶ùÏÑúÎ≤ÑÎ•º Îî∞Î°ú Íµ¨ÌòÑÌï®ÏúºÎ°úÏç® Îã§Î•∏ Í≥≥ÏóêÏÑúÎèÑ Ìé∏ÌïòÍ≤å Ïù¥Ïö©Ìï† Ïàò ÏûàÎèÑÎ°ù Íµ¨ÌòÑ
* Chat Server
  * Ï±ÑÌåÖÏÑúÎ≤ÑÎ•º ÏàòÎèôÏúºÎ°ú 2ÎåÄ Íµ¨Ï∂ï
  > Ï∂îÌõÑ K8SÏùò auto-scalingÏúºÎ°ú Íµ¨ÌòÑÌï† ÏòàÏ†ï
* Kafka Broker
  * ÌÜ†ÌîΩÏùÄ Îëê Í∞úÎ°ú Ïò¨Î†∏ÏúºÎ©∞, Í∞ÅÍ∞Å broker 3ÎåÄ Î∞è 2Í∞úÏùò ÌååÌã∞ÏÖòÏóê Í±∏Ï≥ê Î∞±ÏóÖÎêòÎèÑÎ°ù Ïö¥Ïö©
  > ÌååÌã∞ÏÖòÏùÄ 200Í∞úÍ∞Ä Ï†ÅÎãπÌïòÎã§Í≥† ÌïúÎã§. ÏßÄÍ∏à ÎãπÏû•ÏùÄ 2Í∞úÏùò ÌååÌã∞ÏÖòÏúºÎ°ú Ïö¥Ïö©.

### Íµ¨ÌòÑ ÎØ∏ÏôÑÎ£å
* Front Server
  * API GATEWAYÏóê ÎπÑÎèôÍ∏∞+ÎÖº Î∏îÎ°úÌÇπ webClientÎ°ú ÏöîÏ≤≠ Ï†ÑÏÜ° ÏòàÏ†ï
* Log Server
  * DBÏÑ†Ï†ïÏóê ÏûàÏñ¥ Í≥†ÎØºÏù¥ ÏûàÎã§. Ïó¨Îü¨Í∞ÄÏßÄ ÎπÑÍµêÌï¥Î¥§ÏùÑ Îïå, 1Ï∞®Ï†ÅÏúºÎ°ú Elastic SearchÏùÑ ÏÑ†ÌÉùÌïòÏòÄÎã§. [ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞Ïóê ÎßûÎäî DBÎäî?](https://www.reddit.com/r/Database/comments/w8eb0g/best_db_for_logging/)
  > * **Elastic Search** = RESTful apiÍ∏∞Î∞òÏúºÎ°ú Ïó¨Îü¨ Í≥≥ÏóêÏÑú ÌôúÏö© Í∞ÄÎä•ÌïòÎ©∞, Ïó≠ÏÉâÏù∏ÏùÑ ÏßÄÏõêÌïòÎØÄÎ°ú ÎπÑÏ†ïÌòï doc ÏÉâÏù∏/Í≤ÄÏÉâÏóê ÌÉÅÏõîÌïòÎã§. ÌïÑÏûêÎäî Ï±ÑÌåÖÏùÑ Í¥ÄÏ∞∞ÌïòÎ©∞ ÌäπÏ†ï Îã®Ïñ¥Ïùò ÎπàÎèÑÏàòÎ•º Î™®ÎãàÌÑ∞ÎßÅÌïòÎ†§ ÌïòÎäîÎç∞ Ïù¥Îïå Ïì∞Í∏∞ Îî± Ï¢ãÏùÑÎìØ. ÎòêÌïú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏãúÏ†êÏóê Ìï¥Îãπ Îç∞Ïù¥ÌÑ∞Î•º ÏÉâÏù∏ÌïòÍ∏∞Ïóê Ïã§ÏãúÍ∞ÑÏù¥ ÏïÑÎãåÏ†êÏù¥ ÎßàÏùåÏóê Îì†Îã§. KafkaÎ•º Ïì∞Í∏∞ÎïåÎ¨∏Ïóê Ïã§ÏãúÍ∞ÑÏù¥ ÏïÑÎãê ÎøêÎçîÎü¨, LoggingÏóê Ïã§ÏãúÍ∞ÑÏÑ±Ïù¥ ÌïÑÏöîÏóÜÍ∏∞ÎïåÎ¨∏Ïóê ÏïåÎßûÏùÄ ÏóîÏßÑÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÎêúÎã§.
  > * **HDFS** = Î∂ÑÏÇ∞Ï†ÄÏû• ÏïÑÏßÅ ÌïòÏßÄ ÏïäÏùÑÍ≤ÉÏûÑ
  > * **File System** = TransactionÍ¥ÄÎ¶¨Í∞Ä Ïñ¥Î†§ÏõÄ
  > * **Timescale** = Í∏∞Ï°¥ PostgresÎ•º ÏãúÍ≥ÑÏó¥Î°ú ÌôïÏû•ÏãúÌÇ® DB. Í∑∏ÎûòÏÑú ÏùµÏàôÌïú SQLÎ¨∏ÏùÑ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎã§Îäî Ïû•Ï†êÏù¥ ÏûàÎã§. ÌïòÏßÄÎßå **Îã®Ï†êÏùÄ ÏßÅÏ†ë Î™®Îì† SQLÎ¨∏ÏùÑ ÏûëÏÑ±Ìï¥ÏïºÌïúÎã§**Îäî Ï†êÏù¥Îã§(Ïù¥Ïú†Îäî JPAÏóêÏÑú TimescaleÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÍ∏∞ ÎïåÎ¨∏Ïóê Î™®Îì† DialectÎ•º ÏûëÏÑ±Ìï¥ÏïºÌï®)
  > * **InfluxDB** = Í∞ÄÏû• ÎßéÏù¥ ÏÇ¨Ïö©ÌïòÎäî ÏãúÍ≥ÑÏó¥ DBÏù¥Ïûê, JPAÍ∞Ä ÏßÄÏõêÌïòÎäî ÏãúÍ≥ÑÏó¥ DB.  [Ï∞∏Í≥†ÏûêÎ£å](https://geekflare.com/time-series-database/). ÌïÑÏûêÍ∞Ä ÏõêÌïòÎäî Ï±ÑÌåÖÍ∞úÏàò Î∞è Ïã†Í∑úÍ∞ÄÏûÖÏûê ÏàòÎùºÎäî ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞Îì§ÏùÑ ÎåÄÏãúÎ≥¥ÎìúÎ°ú Î≥ÑÎèÑÎ°ú ÏâΩÍ≤å ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.
  >
  > **InfluxDB**Îäî real-time queryingÏóê Ï¢ãÎã§Í≥† ÌïòÎäîÍ≤É Í∞ôÏùÄÎç∞, Ïö∞Î¶¨Îäî Ïπ¥ÌîÑÏπ¥Î•º ÏÇ¨Ïö©ÌïòÍ∏∞ÎïåÎ¨∏Ïóê Ìï¥Îãπ Ïû•Ï†êÏùÑ ÌôúÏö©ÌïòÏßÄ ÏïäÎäîÎã§.
  * ÎßåÏïΩ InfluxDBÎ•º ÏÑ†ÌÉùÌïúÎã§Î©¥, ÏãúÍ≥ÑÏó¥Îç∞Ïù¥ÌÑ∞Îäî Îã§ÏùåÍ≥º Í∞ôÏù¥ Îëê Í∞ÄÏßÄÎ°ú Í∞ÅÍ∞ÅÏùò ÌïòÏù¥ÌçºÌÖåÏù¥Î∏îÏùÑ Íµ¨ÏÑ±Ìï† ÏòàÏ†ï
    * symbol = chatAdd, data = Ï±ÑÌåÖ ÏûÖÎ†• Ïàò
    * symbol = userAdd, data = Ïã†Í∑úÍ∞ÄÏûÖÏûê Ïàò
* Orchestration saga
  * ÌïÑÏûêÎäî KafkaÎ•º MSAÏùò Î∞±Î≥∏ÎßùÏúºÎ°ú ÏÇ¨Ïö©ÌïúÎã§. Îî∞ÎùºÏÑú [saga](https://ghkdqhrbals.github.io/posts/micro-service-architecture1)Ïùò Ìå®ÌÑ¥ Ï§ë Ï§ëÏïôÏßëÍ∂åÌòïÏù∏ Orchestration Ìå®ÌÑ¥ÏúºÎ°ú Î™®ÎãàÌÑ∞ÎßÅÏùÑ Ï§ëÏïôÏóêÏÑú Ìï† Í≤ÉÏù¥Îã§.
  * ÏÇ¨Ïö©Ìï† Î™®ÎãàÌÑ∞ÎßÅ Ìà¥ Î¶¨Ïä§Ìä∏
    * Î©îÏÑ∏ÏßÄ Î™®ÎãàÌÑ∞ÎßÅ [UI for Kafka](https://github.com/provectus/kafka-ui)
    > ![img1](../../../assets/img/kafka/1.png)
    >
    > ![img2](../../../assets/img/kafka/2.png)
    > Ïπ¥ÌîÑÏπ¥ ÏÑúÎ≤Ñ Ïó∞Í≤∞ Î∞è Consumer Group ÌôïÏù∏/ ÌÜ†ÌîΩ ÌôïÏù∏Ïù¥ Ïö©Ïù¥ÌïòÎã§. ÎòêÌïú Ïã§Ï†ú Î©îÏÑ∏ÏßÄ ÎÇ¥Ïö©ÎèÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏñ¥ÏÑú Ìé∏Î¶¨ÌïòÎã§.
    * Consumer Ìä∏ÎûòÌîΩ Î™®ÎãàÌÑ∞ÎßÅ [https://s262701-id.tistory.com/126](https://s262701-id.tistory.com/126)
    > * LinkedinÏùò **burrow**
    > * lagÏ†ïÎ≥¥ **Elasticsearch** ÏàòÏßë Îç∞Ïù¥ÌÑ∞ÌååÏù¥ÌîÑÎùºÏù∏
    > * ElasticSearchÏóê Í∏∞Î°ùÎêú lag Ï†ïÎ≥¥ Í∏∞Î∞ò **Grafana** lag Î™®ÎãàÌÑ∞ÎßÅ ÎåÄÏãúÎ≥¥Îìú
  > [Í∞ÅÍ∞ÅÏùò Kafka Î™®ÎãàÌÑ∞ÎßÅ Ìà¥ ÎπÑÍµê](https://towardsdatascience.com/overview-of-ui-tools-for-monitoring-and-management-of-apache-kafka-clusters-8c383f897e80)

## ÏôÑÎ£åÎêú ÏÑ§Ï†ï
ÏÉÅÏÑ∏ ÏΩîÎìúÎäî [https://github.com/ghkdqhrbals/spring-chatting-server](https://github.com/ghkdqhrbals/spring-chatting-server)ÏóêÏÑú ÌôïÏù∏ÌïòÎä•ÌïòÎã§.
> main branchÏóê Ï°¥Ïû¨

### ÏôÑÎ£åÎêú API GATEWAY(nginx.config)
```
user  nginx;
worker_processes  1;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;
events {
    worker_connections  1024;
}
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    upstream chat-server {
        # IP Ìï¥Ïâ¨Ìôî ÌïòÏó¨ ÌäπÏ†ï ÏÑúÎ≤ÑÏóê Îì§Ïñ¥Í∞ÄÎèÑÎ°ù ÏÑ§Ï†ï
        # https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ip_hash
        ip_hash;
        server chatting-server-1:8083;
        server chatting-server-2:8084;
    }
    upstream auth-server {
        server auth-server:8085;
    }
    server {
        listen 80;
        # Ï∂îÌõÑ server_name Î≥ÄÍ≤ΩÏòàÏ†ï
        server_name localhost;

        location / {
            # Ï±ÑÌåÖÏÑúÎ≤Ñ backend
            location /chat {
                proxy_pass         http://chat-server;
                proxy_redirect     off;
                proxy_set_header   Host $host;
                proxy_set_header   X-Real-IP $remote_addr; # ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏöîÏ≤≠ ipÏ†ÑÏÜ°
                proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; # ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏöîÏ≤≠ ipÏ†ÑÏÜ°
            }
            # Ïù∏Ï¶ùÏÑúÎ≤Ñ backend
            location /user {
                rewrite ^([^.]*[^/])$ $1/ permanent; # tailing slash with every url
                proxy_pass         http://auth-server;
                proxy_redirect     off;
                proxy_set_header   Host $host;
                proxy_set_header   X-Real-IP $remote_addr;
                proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
            }
        }

    }
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    keepalive_timeout  65;
    include /etc/nginx/conf.d/*.conf;
}
```

### ÏôÑÎ£åÎêú Docker-compose.yml
Kafka ÏÑ§Ï†ïÏóê ÏûàÏñ¥ [https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc/](https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc/) Î¨∏ÏÑúÍ∞Ä ÎßéÏùÄ ÎèÑÏõÄÏù¥ ÎêòÏóàÎã§.

```dockerfile
version : '2'
services:
  # -------- API GATEWAY --------
  nginx:
    restart: always
    container_name: nginx
    depends_on:
      - chatting-server-1
      - chatting-server-2
    build:
      context: ./nginx
      dockerfile: Dockerfile
    ports:
      - "8080:80"

  # -------- KAFKA --------
  zookeeper:
    image: confluentinc/cp-zookeeper:7.2.1
    container_name: zookeeper
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
  kafka1:
    image: confluentinc/cp-kafka:7.2.1
    container_name: kafka1
    ports:
      - "8097:8097"
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: EXTERNAL:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: EXTERNAL://localhost:8097,INTERNAL://kafka1:9092
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
  kafka2:
    image: confluentinc/cp-kafka:7.2.1
    container_name: kafka2
    ports:
      - "8098:8098"
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 2
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: EXTERNAL:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: EXTERNAL://localhost:8098,INTERNAL://kafka2:9092
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
  kafka3:
    image: confluentinc/cp-kafka:7.2.1
    container_name: kafka3
    ports:
      - "8099:8099"
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 3
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: EXTERNAL://localhost:8099,INTERNAL://kafka3:9092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: EXTERNAL:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL

  # -------- Chatting Server --------
  chatting-db-1:
    container_name: chatting-db-1
    image: postgres:12-alpine
    environment:
      - POSTGRES_PASSWORD=password
      - POSTGRES_USER=postgres
      - POSTGRES_DB=chat
    expose:
      - "5433" # Publishes 5433 to other containers but NOT to host machine
    ports:
      - "5433:5433"
    volumes:
      - ./backups:/home/backups
    command: -p 5433
  chatting-server-1:
    container_name: chatting-server-1
    build: ./spring-chatting-backend-server
    ports:
      - "8083:8083"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:postgresql://chatting-db-1:5433/chat
      - SPRING_DATASOURCE_USERNAME=postgres
      - SPRING_DATASOURCE_PASSWORD=password
      - SPRING_JPA_HIBERNATE_DDL_AUTO=update
      - SERVER_PORT=8083
      - KAFKA_BOOTSTRAP=kafka1:9092,kafka2:9092,kafka3:9092 # ÎÇ¥Î∂ÄÌè¨Ìä∏
    depends_on:
      - kafka1
      - kafka2
      - kafka3
      - chatting-db-1
    restart: always
  chatting-db-2:
    container_name: chatting-db-2
    image: postgres:12-alpine
    environment:
      - POSTGRES_PASSWORD=password
      - POSTGRES_USER=postgres
      - POSTGRES_DB=chat
    expose:
      - "5434" # Publishes 5433 to other containers but NOT to host machine
    ports:
      - "5434:5434"
    volumes:
      - ./backups:/home/backups
    command: -p 5434
  chatting-server-2:
    container_name: chatting-server-2
    build: ./spring-chatting-backend-server
    ports:
      - "8084:8084"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:postgresql://chatting-db-2:5434/chat
      - SPRING_DATASOURCE_USERNAME=postgres
      - SPRING_DATASOURCE_PASSWORD=password
      - SPRING_JPA_HIBERNATE_DDL_AUTO=update
      - SERVER_PORT=8084
      - KAFKA_BOOTSTRAP=kafka1:9092,kafka2:9092,kafka3:9092 # ÎÇ¥Î∂ÄÌè¨Ìä∏
    depends_on:
      - kafka1
      - kafka2
      - kafka3
      - chatting-db-2
    restart: always

  # -------- Authentication Server --------
  auth-db:
    container_name: auth-db
    image: postgres:12-alpine
    environment:
      - POSTGRES_PASSWORD=password
      - POSTGRES_USER=postgres
      - POSTGRES_DB=auth
    expose:
      - "5435" # Publishes 5433 to other containers but NOT to host machine
    ports:
      - "5435:5435"
    volumes:
      - ./backups:/home/backups
    command: -p 5435
  auth-server:
    container_name: auth-server
    build: ./spring-auth-backend-server
    ports:
      - "8085:8085"
    environment:
      - SERVER_PORT=8085
      - SPRING_DATASOURCE_URL=jdbc:postgresql://auth-db:5435/auth
      - SPRING_DATASOURCE_USERNAME=postgres
      - SPRING_DATASOURCE_PASSWORD=password
      - SPRING_JPA_HIBERNATE_DDL_AUTO=update
    depends_on:
      - auth-db
    restart: always
```

