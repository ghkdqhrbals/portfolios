---
layout: default
title: 40. ì„œë²„ ì„±ëŠ¥ê°œì„  ê¸°ë¡ - 1 (ì‘ì„±ì¤‘)
parent: ğŸ“Œ ì‹¤ì‹œê°„ ì±„íŒ…ì„œë²„ í”„ë¡œì íŠ¸
nav_order: 40
---

created at 2023-12-13
{: .label .label-yellow }

# ngrinder ë¥¼ í†µí•œ ë¡œê·¸ì¸ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

### https://www.litcodev.com/api/login
* ë¡œê·¸ì¸

![img](../../../assets/performance/chatloginUser99.png)
![img](../../../assets/performance/chatloginUser990.png)

### https://foxee.co.kr/api/login
* ë¡œê·¸ì¸

![img](../../../assets/performance/foxeeloginUser2500.png)

### https://www.litcodev.com/api-chat/friends
* ë¡œê·¸ì¸ í›„ ì¹œêµ¬ëª©ë¡ ì¡°íšŒ
* Groovy Script

![image](https://github.com/ghkdqhrbals/spring-chatting-server/assets/29156882/25b8b613-616f-44f8-8fd4-44cb1d2ace90)

![image](https://github.com/ghkdqhrbals/spring-chatting-server/assets/29156882/c0cfc2c3-d0f0-45a1-85b0-a2f9f3e11cc9)

```groovy
@RunWith(GrinderRunner)
class TestRunner {

	public static GTest test
	public static HTTPRequest request
	public static Map<String, String> headers = [:]
	public static String loginBody = "{\n    \"username\":\"your_id\",\n    \"password\":\"your_password\"\n}"
	public static List<Cookie> cookies = []

	@BeforeProcess
	public static void beforeProcess() {
		HTTPRequestControl.setConnectionTimeout(300000)
		test = new GTest(1, "www.litcodev.com")
		request = new HTTPRequest()

		// Set header data
		headers.put("Content-Type", "application/json")
		grinder.logger.info("before process.")

		// ë¡œê·¸ì¸ ìš”ì²­
		HTTPResponse loginResponse = request.POST("https://www.litcodev.com/api/login", loginBody.getBytes())
		if (loginResponse.statusCode == 200) {
			cookies=CookieManager.getCookies()
			grinder.logger.info("cookies: {}", cookies)
		} else {
			grinder.logger.error("Login failed with status code: {}", loginResponse.statusCode)
		}
	}

	@BeforeThread
	public void beforeThread() {
		test.record(this, "test")
		grinder.statistics.delayReports = true
		grinder.logger.info("before thread.")
	}

	@Before
	public void before() {
		request.setHeaders(headers)
		CookieManager.addCookies(cookies)
		grinder.logger.info("before. init headers and cookies")
	}

	@Test
	public void test() {
		HTTPResponse chatResponse = request.GET("https://www.litcodev.com/api-chat/friends")
		if (chatResponse.statusCode == 301 || chatResponse.statusCode == 302) {
			grinder.logger.warn("Warning. The response may not be correct. The response code was {}.", chatResponse.statusCode)
		} else {
			assertThat(chatResponse.statusCode, is(200))
		}
	}
}
```

[ë¬¸ì œì -1] ê³¼ë„í•œ ë¶€í•˜ë¶„ì‚° í…ŒìŠ¤íŠ¸ ì‹œ, EKS ë…¸ë“œ í´ëŸ¬ìŠ¤í„° ë‚´ ë…¸ë“œê°€ ì•„ì˜ˆ ì£½ì–´ë²„ë¦¬ëŠ” ê²½ìš°
{: .text-red-200}
ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” API ì¸ `POST /api/login` ì— 1000ëª…ì˜ ë™ì‹œ ì‚¬ìš©ì ìš”ì²­ì„ nGrinderë¥¼ í†µí•´ ë¶€í•˜ë¶„ì‚° í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ë”ë‹ˆ, cpu ì‚¬ìš©ë¥ ì´ 100% ì— ë„ë‹¬í•˜ë©´ì„œ ì›Œì»¤ë…¸ë“œê°€ ì£½ì–´ë²„ë ¸ìŠµë‹ˆë‹¤.

[í•´ê²°ë°©ë²•-1] cpu limit ì„¤ì •
{: .text-green-200}

ì²« ë²ˆì§¸ ë°©ë²•ìœ¼ë¡œëŠ” ê° íŒŒë“œ ë³„ë¡œ resource limit ì„ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ í•˜ë‚˜ì˜ íŒŒë“œê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ cpu ë‚˜ memory ì˜ ë¦¬ì†ŒìŠ¤ limit ì„ ì´ˆê³¼í•˜ê²Œ ë˜ë©´, OOKill ì„ ê°•ì œë¡œ ë°œìƒì‹œí‚µë‹ˆë‹¤. 
ê·¸ë˜ì„œ ë…¸ë“œì˜ resource usage ë¥¼ 100% ì°ëŠ”ê±¸ ë§‰ì„ ìˆ˜ ìˆê²Œ ë˜ê² ì£ ?

ì¼ë‹¨ ì´ ë°©ë²•ì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•Œë§ëŠ” limit ì„ ì ì–´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë¨¼ì € ê° íŒŒë“œì˜ cpu ì‚¬ìš©ëŸ‰ì„ í™•ì¸í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

<img width="1476" alt="image" src="https://github.com/ghkdqhrbals/spring-chatting-server/assets/29156882/af15bb3b-522d-45fa-bed8-baa08babad0c">

`VUSER=100` ì¼ ë•Œ chatting ì„œë²„ì˜ vcpu ì½”ì–´ ì‚¬ìš©ëŸ‰ì€  1.21 ê¹Œì§€ ì¦ê°€í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  `VUSER=1000` ì¼ ë• 1.80 ê¹Œì§€ ì¦ê°€í•˜ëŠ”ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. 
ë§Œì•½ chatting ì„œë²„ì˜ cpu limit ì„ 1.7ë¡œ ì„¤ì •í•´ì¤€ë‹¤ë©´, ë™ì‹œì ‘ì†ì ìˆ˜ ì´ˆê³¼ì¼ ë•Œ ë…¸ë“œìì²´ê°€ ì£½ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆê² ì£ ? 

í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ ë…¸ë“œëŠ” ì•ˆì£½ì„ ì§€ ëª¨ë¥´ì§€ë§Œ ì„œë¹„ìŠ¤ ìì²´ê°€ ì£½ëŠ” ê²½ìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë‘ ë²ˆì§¸ ë°©ë²•ìœ¼ë¡œëŠ” HPA ë¥¼ í†µí•´ íŒŒë“œì˜ ê°œìˆ˜ë¥¼ ëŠ˜ë ¤ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤.

[í•´ê²°ë°©ë²•-2] HPA ì„¤ì •

```yaml

ëª‡ ê°€ì§€ ìƒê°í•´ë³¸ ê²°ê³¼, cpu limit ì„¤ì •ì„ í†µí•´ cpu ì‚¬ìš©ë¥ ì„ ì œí•œí•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ cpu limit ì„ ì„¤ì •í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

```yaml
resources:
  limits:
    cpu: 1000m
```


