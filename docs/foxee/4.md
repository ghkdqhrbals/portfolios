---
layout: default
title: 4. ì „ì²´ ì•„í‚¤í…ì²˜ ì„¤ê³„ì™€ êµ¬í˜„  
parent: ðŸ“Œ XAIë¥¼ í™œìš©í•œ ì·¨ì•½ì  ë¶„ì„ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜
nav_order: 4
---

updated at : 2023-09-20 18:11

### 1. í˜„ìž¬ ê¹Œì§€ì˜ ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° êµ¬í˜„ ì‚¬í•­ë“¤

![img.png](../arc1.png)

### 2. ê° tag ì— ëŒ€í•œ ìƒì„¸ì„¤ëª…
**(a)** ëª¨ë¸ì„œë²„ëŠ” Kafka MQ ì— ì•„ëž˜ì˜ êµ¬ì¡°ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

* userId, eventId, serverId, analyzeId, status

ë©”ì¸ì„œë²„ëŠ” ëª¨ë¸ì„œë²„ë¡œë¶€í„° ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„ì •ë³´ì™€ ì§„í–‰ìƒí™©ì„ ë°›ì•„ì•¼í•©ë‹ˆë‹¤.

ì´ ë•Œ ì‰½ì§€ì•Šì•˜ë˜ ë¶€ë¶„ì€ ì‹¤ì‹œê°„ í†µì‹ ì— í•­ìƒ ì—´ë ¤ìžˆëŠ” websocket ì´ë‚˜ SSE ê°€ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ 3ë¶„ì—ì„œ 10ë¶„ë™ì•ˆ ëª¨ë¸ì„œë²„ê°€ ê°„ê°„ížˆ ë¶„ì„ê²°ê³¼ë¥¼ ì „ì†¡í•˜ê²Œ ë˜ëŠ”ë°, ì´ ê¸´ ì‹œê°„ë™ì•ˆ ë„¤íŠ¸ì›Œí¬ ìœ ì‹¤ ìœ„í—˜ì„±ë„ ì¡´ìž¬í•˜ë©° File Descriptor(ê° websocket ì´ë‚˜ SSE ë§ˆë‹¤ ì‚¬ìš©ë˜ëŠ” I/O ì‹ë³„ìž)ì˜ ìžì›ì„ ë§Žì´ ë¨¹ëŠ”ë‹¤ëŠ” ë¬¸ì œ ë˜í•œ ì¡´ìž¬í–ˆìŠµë‹ˆë‹¤(ë˜í•œ ê° ì†Œì¼“ ë³„ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¡œ listening í•´ì•¼í•˜ê¸°ì— ìŠ¤ë ˆë“œê°€ ë¶€ì¡±í•´ì§‘ë‹ˆë‹¤, ë¬¼ë¡  í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¡œ ì—¬ëŸ¬ I/O ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì•¡í‹°ë¸Œ ê¸°ìˆ ì€ ì´ ë¬¸ì œë¥¼ ì¼ì‹œì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤).

"íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°(File Descriptor)ëŠ” ìš´ì˜ ì²´ì œê°€ ì—´ë¦° íŒŒì¼ ë˜ëŠ” ì†Œì¼“ê³¼ ê´€ë ¨ëœ I/O ìž‘ì—…ì„ ì¶”ì í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ì‹ë³„ìžìž…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ë¦¬ëˆ…ìŠ¤ê°€ ê½¤ ë†’ì€ FD ê°œìˆ˜ë¥¼ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤."

ë”°ë¼ì„œ ë„¤íŠ¸ì›Œí¬ ìœ ì‹¤ ì‹œ ìž¥ì•  ë³µêµ¬ì™€ ë¶ˆí•„ìš”í•œ ìžì›ì†Œëª¨ë¥¼ ì¤„ì´ê¸° ìœ„í•´ì„œ, ì´ë²¤íŠ¸ë¥¼ ì•ˆì „í•˜ê²Œ íŒŒì¼ ì‹œìŠ¤í…œì— ì €ìž¥í•˜ê³  offset ìœ¼ë¡œ ìž¥ì• ë³µêµ¬ê°€ ê°€ëŠ¥í•˜ë©° ì ì€ ìŠ¤ë ˆë“œë¡œ ê°„ê°„ížˆ ì „ì†¡í•˜ëŠ” ì´ë²¤íŠ¸ë“¤ì„ ë°›ì„ ìˆ˜ ìžˆëŠ” Kafka ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.

"ë¬¼ë¡  í•˜ë‚˜ì˜ ì›¹ ì†Œì¼“ì— ì—¬ëŸ¬ ì„œë²„ê°€ ë™ì‹œì— ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ”ê²ƒì€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ íš¨ê³¼ì ìœ¼ë¡œ ìžì›ì„ ì†Œëª¨ì‹œí‚¬ ìˆ˜ ìžˆì£ . ë‹¤ë§Œ, ì›¹ ì†Œì¼“ì„ í´ëŸ¬ìŠ¤í„°ë§í•˜ì—¬ ê´€ë¦¬í•´ì•¼í•˜ëŠ” ìˆ˜ê³ ê°€ ì¡´ìž¬í•˜ë©° ë„¤íŠ¸ì›Œí¬ ìœ ì‹¤ì‹œ ìž¥ì• ëŒ€ì‘ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. 1. ì„œë²„ì¸¡ì˜ ì—°ê²°ì„ ìž¬í™•ì¸í•´ì•¼í•˜ë©°, 2. ì„œë²„ ê°„ ì„œë¡œì˜ ì„¸ì…˜ì„ ê´€ë¦¬í•´ì•¼í•˜ê² ì£ . 3. ì—¬ëŸ¬ëŒ€ì˜ ì„œë²„ë¥¼ ìžë™ìœ¼ë¡œ ë¬¶ì–´ì£¼ëŠ” í´ëŸ¬ìŠ¤í„°ë§ë„ í•„ìš”í•  ê²ƒì´ë©°, 4. ì„œë²„ ê°„ ë©”ì„¸ì§€ ì½ê³  ì“°ëŠ” ì†ë„ë¥¼ ì¡°ì ˆí•˜ê¸° ìœ„í•´ ë°±í”„ëž˜ì…” ë˜í•œ ì¡´ìž¬í•´ì•¼í•  ê²ƒìž…ë‹ˆë‹¤. ì´ ë°–ì— ì‹ ê²½ì“¸ ë¶€ë¶„ë“¤ì´ ë„ˆë¬´ë‚˜ë„ ë§Žê¸°ë•Œë¬¸ì— ì´ë¯¸ ëŒ€ë¶€ë¶„ êµ¬í˜„ë˜ì–´ ìžˆê³  ì•ˆì „ì„±ì´ ê²€ì¦ëœ Kafka ë¥¼ ì‚¬ìš©í•œ ê²ƒìž…ë‹ˆë‹¤."

ë˜í•œ Kafka ì— TLS ì„¤ì • ì´ë‚˜ ACL(Access Controll List) ì„¤ì •ì„ ë”°ë¡œ í•  í•„ìš”ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤. ì´ìœ ëŠ” ëŒ€ë¶€ë¶„ì˜ ì„œë²„ê°€ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë§ ì—ì„œ ëŒì•„ê°€ë©° Gateway ì™€ EUREKA ì„œë²„ë§Œ ë…¸ì¶œë˜ì–´ìžˆê¸°ë•Œë¬¸ì´ì£ .

**(b)** ëª¨ë“  Gateway ëŠ” EUREKA server ì— ë“±ë¡ëœ ì„œë²„ë“¤ì—ê²Œ ë¡œë“œë°¸ëŸ°ì‹±ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤

EUREKA ì„œë²„ë¥¼ í†µí•´ì„œ ëª¨ë“  ì„œë²„ë“¤ì˜ url ë¥¼ í•œê³³ì—ì„œ ê´€ë¦¬í•˜ê³  ì´ë¥¼ Gateway ê°€ ìžë™ìœ¼ë¡œ ì½ê³  ë¡œë“œë°¸ëŸ°ì‹±í•˜ë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì¼ì¢…ì˜ ê°œë°œ íŽ¸ë¦¬ì„±ì„ ìœ„í•´ ë§Œë“  ì„œë²„ì£ . ê·¸ë¦¬ê³  ë©”ì¸ ì„œë²„ì™€ ëª¨ë¸ ì„œë²„ë“¤ì´

**(c)** Redis ì— ì´ë²¤íŠ¸ë¥¼ ëª¨ë‘ ì €ìž¥í•©ë‹ˆë‹¤. (10 min ì´ˆê³¼ ì‹œ, ìžë™ì‚­ì œ)

* userId, eventId, serverId, analyzeId, status, createdAt

ì €ëŠ” Kafka ë¡œ ë¶€í„° ìˆ˜ì‹ í•œ ì´ë²¤íŠ¸ë¥¼ ì €ìž¥í•´ì•¼í•©ë‹ˆë‹¤. ìµœì¢… ì´ë²¤íŠ¸ ìˆ˜ì‹  ì‹œ, ì´ì „ ê°™ì€ event id ë¥¼ ê°€ì§€ëŠ” ì´ë²¤íŠ¸ë“¤ê³¼ ë¹„êµí•˜ëŠ” ë¡œì§ì„ ìˆ˜í–‰í•´ì•¼í•˜ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” ì–´ë””ì— ì €ìž¥í•˜ëŠ” ì§€ê°€ ì¤‘ìš”í–ˆìŠµë‹ˆë‹¤. ì´ ì´ë²¤íŠ¸ ì €ìž¥ì€ ë¹ˆë²ˆí•˜ê²Œ ì¼ì–´ë‚˜ë©°, ì´ë²¤íŠ¸ ì €ìž¥ ì‹œ íŠ¸ëžœì ì…˜ ê²©ë¦¬ëŠ” í•„ìš”ì—†ìŠµë‹ˆë‹¤. ë¹ ë¥´ê²Œ ì´ë²¤íŠ¸ë“¤ì€ ì €ìž¥ë˜ì–´ì•¼í•˜ë©°, ë¹ ë¥´ê²Œ ì½ì„ ìˆ˜ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œ ì €ëŠ” Redis ì¸ë©”ëª¨ë¦¬ DBë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤. ë©”ëª¨ë¦¬ ìœ„ì— ì €ìž¥í•˜ê¸°ë•Œë¬¸ì— ìƒë‹¹ížˆ ë¹ ë¥¸ ì„±ëŠ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ë°ì´í„° ìµœëŒ€ ìœ ì§€ ì‹œê°„ì€ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ í†µí‹€ì–´ ê±¸ë¦¬ëŠ” ìµœëŒ€ ì†Œìš” ì‹œê°„ì¸ 10ë¶„ì„ ìž¡ì•˜ìŠµë‹ˆë‹¤.

**(d)** WebSocket ìœ¼ë¡œ ì‹¤ì‹œê°„ ë¶„ì„ì§„í–‰ë„ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.

ì´ë²¤íŠ¸ë¥¼ KafkaListener ì„ í†µí•´ì„œ ì½ê³ , Redis ì— ì €ìž¥ê³¼ ë™ì‹œì— ì‚¬ìš©ìžì—ê²Œ ë™ì¼í•œ json ì„ ì†Œì¼“ì„ í†µí•´ ì „ì†¡í•©ë‹ˆë‹¤. ì†Œì¼“ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ê°€ ë¶„ì„ ì¤‘ì§€ë¥¼ ìš”ì²­í•˜ë©´, rollback ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**(e)** ë©”ì¸ ì„œë²„ëŠ” ëª¨ë¸B ì„œë²„ì—ê²Œ íŒŒì¼ê³¼ í•¨ê»˜ ë¶„ì„ API ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ëª¨ë¸ ì„œë²„ëŠ” (a) ë¥¼ ì§€ì†ì ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.

ì´ ì§„í–‰ìƒí™© ì´ë²¤íŠ¸ëŠ” ë©±ë“±ì„±ì´ ì¤‘ìš”í•œ ë¡œì§ì€ ì•„ë‹ˆì§€ë§Œ, ì´ í›„ ë©±ë“±ì„±ì„ ë³´ìž¥í•  ìˆ˜ë„ ìžˆê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ë©”ì„¸ì§€ë¥¼ Eventually consistance í•˜ê²Œ ì„±ê³µì‹œí‚¤ëŠ” Exactly-Once í˜•ì‹ìœ¼ë¡œ  ì „ì†¡í•˜ê²Œë©ë‹ˆë‹¤.

**(f)** ëª¨ë¸ ì„œë²„ì— GET /analysis?serverId=143 ì„ ì „ì†¡í•˜ë©´, Gateway-3 ì€ EUREKA ì„œë²„ì—ê²Œ MODEL_SERVER ì˜ url ë“¤ì„ ìš”ì²­í•©ë‹ˆë‹¤. ë˜í•œ í•´ë‹¹ ì„œë²„ë“¤ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. ì´í›„ ë©”íƒ€ë°ì´í„°ì— ì €ìž¥ëœ serverId ê°€ 143ì¸ ì„œë²„ url ì—ê²Œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ serverId ëŠ” ìžë™ìœ¼ë¡œ ë¡œë“œë°¸ëŸ°ì‹±ëœ íŒŒì¼ì €ìž¥ API ê°€ ë„ì°©í•œ ëª¨ë¸ ì„œë²„ì˜ ê³ ìœ ë²ˆí˜¸ìž…ë‹ˆë‹¤. ì¦‰, íŒŒì¼ ì €ìž¥ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì„œë²„ì‹ë³„ë²ˆí˜¸ì¸ê²ƒì´ì£ . ëª¨ë¸ ì„œë²„ëŠ” ìœ ë ˆì¹´ ì„œë²„ì— ìžì‹ ì„ ë“±ë¡í•  ë•Œ ë©”íƒ€ë°ì´í„°ì— ê³ ìœ ë²ˆí˜¸ì™€ í•¨ê»˜ ë“±ë¡ì‹œí‚µë‹ˆë‹¤.

ëª¨ë¸ ì„œë²„ê°€ ìˆ˜í‰ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§ ëœë‹¤ëŠ” ê°€ì • ë•Œë¬¸ì— ì„œë²„ ì‹ë³„ë²ˆí˜¸ë¥¼ ë¶€ì—¬í•  ìˆ˜ ë°–ì— ì—†ì—ˆìŠµë‹ˆë‹¤. ë§Œì•½ ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ë¶„ì„ì´ ëë‚œ ëª¨ë¸ ì„œë²„ê°€ ì €ìž¥í•˜ê³ ìžˆëŠ” ë¶„ì„ê²°ê³¼ íŒŒì¼ì˜ ì‹¤ì œ ìœ„ì¹˜ê°€ Model B ì¤‘ ì–´ë””ì¸ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì´ì£ .

**(g)** **(f)** ì—ì„œ ìš”ì²­í•œ ê²°ê³¼ë“¤ì„ ì••ì¶•í•˜ì—¬ ìŠ¤íŠ¸ë¦¼í˜•ì‹ìœ¼ë¡œ ë°›ì•„ì™€ì„œ ë©”ì¸ ì„œë²„ì— ì €ìž¥í•©ë‹ˆë‹¤. ì €ìž¥ì´ ëë‚˜ë©´ ë©”ì¸ ì„œë²„ëŠ” ëª¨ë¸ ì„œë²„ì—ê²Œ ë¶„ì„ê²°ê³¼ë“¤ì„ ì‚­ì œë¥¼ ì§€ì‹œí•©ë‹ˆë‹¤. ì´ë¯¸ ìµœì¢… ê²°ê³¼ë¬¼ë“¤ì€ ë©”ì¸ì„œë²„ì— ì €ìž¥ì´ ë˜ì—ˆê¸° ë•Œë¬¸ì´ì£ .

**(h)** TLS ì˜¤í”„ë¡œë”©ì€ ì„œë²„ë³´ë‹¤ ì•žì—ì„œ ì¤‘ê°„ ë§¤ê°œì²´(ì—¬ê¸°ì„œëŠ” ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œì¸ Gateway)ê°€ TLS ì•”í˜¸í™”/ë³µí˜¸í™”ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê¸°ìˆ ìž…ë‹ˆë‹¤. ì„œë²„ê°€ í”„ë¡ì‹œì™€ ë‚´ë¶€ë§ì— í•¨ê»˜ ìžˆì–´ì•¼ ì•ˆì „í•©ë‹ˆë‹¤. í˜„ìž¬ì˜ ê²½ìš°ì—ëŠ” í•¨ê»˜ ìžˆì§€ë§Œ ì¶”í›„ ë©”ì¸ì„œë¹„ìŠ¤ê°€ ë–¨ì–´ì§€ê²Œ ëœë‹¤ë©´, í•˜ë‚˜ì˜ TLS ë¥¼ ë”  ì¶”ê°€í•´ì•¼ë©ë‹ˆë‹¤.

### 3. ì—¬ëŸ¬ ì œì•½ì‚¬í•­ë“¤

* ëª¨ë¸ì„œë²„ì˜ ë©”ëª¨ë¦¬ëŠ” 16GB ë¡œ ìƒë‹¹ížˆ ìž‘ìŠµë‹ˆë‹¤.
> ê¸°ë³¸ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ë¶„ì„ API ìš”ì²­ì€ ì•½ 1GB ì •ë„ì˜ íŒŒì¼ê³¼ í•¨ê»˜ ìš”ì²­ë˜ê¸°ë•Œë¬¸ì— ë¹ ë¥´ê²Œ ë©”ëª¨ë¦¬ì—ì„œ êº¼ë‚´ì•¼í•©ë‹ˆë‹¤. íŒŒì¼ì„ ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼í˜•íƒœë¡œ ê·¸ë•Œê·¸ë•Œ ì½ì–´ì„œ ë¶„ì„ì„ ìˆ˜í–‰í•´ì•¼í•©ë‹ˆë‹¤.
> 