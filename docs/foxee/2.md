---
layout: default
title: 1. Git actions ì—ì„œ h2 ë©”ëª¨ë¦¬ DB ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì‹œ Object.equals ì—ëŸ¬ ì²˜ë¦¬ 
parent: ğŸ“Œ XAIë¥¼ í™œìš©í•œ ì·¨ì•½ì  ë¶„ì„ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜
nav_order: 1
---

updated at : 2023-08-26

## Description

Git Actions ë‚´ ì—ì„œ ë¹Œë“œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•Œ, H2 ì¸ë©”ëª¨ë¦¬ db ì—ì„œ ê°€ì ¸ì˜¨ LocalDateTime ì˜ ê°’ ë¹„êµê°€ ì‹¤íŒ¨í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.

ë°˜ë©´ ë¡œì»¬ì—ì„œ ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì‹œì—ëŠ” h2 ì—ì„œ LocalDateTime ì˜ ê°’ ë¹„êµê°€ ì˜¬ë°”ë¥´ê²Œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. ì–´ë–¤ ë¬¸ì œì˜€ì„ê¹Œìš”?


### Problem Check - 1

![img](../../../assets/foxee/3.png)

ìœ„ì˜ ê·¸ë¦¼ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë“¯, Git Actions ë‚´ë¶€ì—ì„œ LocalDateTime ì€ ì•„ë˜ì™€ ê°™ì´ í•˜ìœ„ 6ìë¦¬ë¥¼ ë„˜ì–´ì„œ 9ìë¦¬ ê¹Œì§€ ì„¤ì •ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ê·¸ë˜ì„œ ì¶”ê°€ì ì¸ 3ìë¦¬ì˜ ìˆ«ìë•Œë¬¸ì— equals ê°€ false ë¡œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ equals ì˜¤ë²„ë¼ì´ë”© ì‹œ, LocalDateTime ì˜ millisecond ë¥¼ í•˜ìœ„ 6ìë¦¬ ê¹Œì§€ë§Œ **ì˜ë¼ë‚¸ë‹¤ë©´** ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œìš”?

### Problem Check - 2

![img](../../../assets/foxee/2.png)

ì•„ë‡¨... ì•Œê³ ë³´ë‹ˆ h2 ëŠ” ìì²´ì ìœ¼ë¡œ ë¼ìš´ë”© í•œ ê°’ì„ ì €ì—ê²Œ ë³´ë‚´ê³  ìˆì—ˆì–´ìš”.

ê·¸ë ‡ë‹¤ë©´ ë¬¸ì œê°€ ì–´ëŠì •ë„ ì •í•´ì¡ŒìŠµë‹ˆë‹¤.

**ë¡œì»¬ì—ì„œ ì´ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•œ ì´ìœ ëŠ” ë¡œì»¬ Java ë²„ì „ì—ì„œ `LocalDateTime.now()` ì˜ nanosecond ë¥¼ ìì²´ì ìœ¼ë¡œ ì˜ë¼ì£¼ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

ê°€ì •1. ê·¸ë ‡ë‹¤ë©´ Java ë²„ì „ ì°¨ì´ë¡œ ì¸í•´ `LocalDateTime.now()` ì˜ ê¸°ë³¸ ë¼ìš´ë”© ì„¤ì •ì´ ë¡œì»¬ê³¼ Git Actions ê°€ ì°¨ì´ë‚¬ë‹¤ë¼ê³  ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?

ë¨¼ì € ë¡œì»¬ì˜ Java ë²„ì „ì„ í™•ì¸í•´ë´…ì‹œë‹¤.

![img](../../../assets/foxee/5.png)

* Corretto - 17.0.6

ê·¸ë¦¬ê³  Git Actions ë¹Œë“œì— ì‚¬ìš©ëœ Java ë²„ì „ì„ í™•ì¸í•´ë´…ì‹œë‹¤.

```yaml
jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      ...
      - name: Set up openJDK correto 17
        uses: actions/setup-java@v3
        with:
          distribution: 'corretto'
          java-version: '17' # ì‹¤ì œ ì„¤ì¹˜ ë²„ì „ì€ Corretto 17.0.8~8.1
...
```

~~ê·¸ë ‡ë‹¤ë©´ Corretto 17.0.6 ë²„ì „ê³¼ 17.0.8.x ë²„ì „ì˜ ë‹¤ë¥¸ì ì€ LocalDateTime.now() ì˜ rounding ìœ ë¬´ë¡œ ë³¼ ìˆ˜ ìˆê² êµ°ìš”!~~ 
> ì´ ë¶€ë¶„ì€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ì¶”ê°€ì ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

Amazon 17.0.6 ì—ì„œ 17.0.8 ì—…ë°ì´íŠ¸ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

ì£¼ìš” í•­ëª©ìœ¼ë¡œëŠ” TZDATA2022D -> TZDATA2022E ê°€ ìˆì–´ìš”.
> [Corretto-17 Timezone ì—…ë°ì´íŠ¸ PR](https://github.com/corretto/corretto-17/pull/99/files)
> ![img](../../../assets/foxee/7.png)

ê·¸ëŸ°ë° ì–˜ë„¤ ì—…ë°ì´íŠ¸ í•­ëª©ì—ëŠ” rounding ì´ ì—†ì–´ìš” ã…œã…œ

{: .important }
> ë¯¸êµ­ê³¼ ìºë‚˜ë‹¤ì˜ DST(ì¼ê´‘ ì ˆì•½ ì‹œê°„ì œ) ë¥¼ ì•„ì˜ˆ ì˜êµ¬ì ìœ¼ë¡œ ë„£ì—ˆë‹¤ëŠ”ê²Œ ì£¼ëœ ì—…ë°ì´íŠ¸ì˜€ì–´ìš”.

> ì¶”ê°€ì ìœ¼ë¡œ í™•ì¸í•´ë³¸ ê²°ê³¼, Java 11 ì—ì„œ 17ë¡œ ë„˜ì–´ì˜¤ë©´ì„œ ë” ì •í™•í•œ íƒ€ì„ì„ ìœ„í•´ nanosecond ê°€ ì¶”ê°€ë˜ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤.
> ê·¸ë¦¬ê³  Java 17 ëŠ” ëª¨ë‘ ë™ì¼í•œ `LocalDateTime.now()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
>
> **ì¦‰, Java 17 ë‚´ë¶€ ë²„ì „ ì°¨ì´ ë¬¸ì œê°€ ì•„ë‹ˆë¼ëŠ” ê²ƒì´ì£ !**

ê·¸ë ‡ë‹¤ë©´ **ê°€ì •1** ì€ í‹€ë ¸ìŠµë‹ˆë‹¤.

ê°€ì •2. ì´ ë¬¸ì œëŠ” `LocalDateTime.now()` ê°€ í˜¸ì¶œí•˜ëŠ” System Clock ì€ ë¡œì»¬(Mac)ì˜ microsecond ê¹Œì§€ í˜¸ì¶œí•˜ê³ , Git Actions(Ubuntu) ëŠ” nanosecond ê¹Œì§€ í˜¸ì¶œë˜ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œì¸ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì¦‰, ìš´ì˜ì²´ì œê°€ ë‹¤ë¥´ê¸° ë–„ë¬¸ì— ë°œìƒí•œ ë¬¸ì œì ì´ì£ .

ì €ëŠ” ë¶„ë€ì˜ ì‹¹ì„ ì œê±°í•˜ê¸° ìœ„í•´ nanosecond ë¥¼ ì—†ì• ê² ìŠµë‹ˆë‹¤. ë°©ë²•ì€ `LocalDateTime.now()` ì— `.truncatedTo(ChronoUnit.MICROS)` ë¥¼ ì¶”ê°€í•˜ì—¬ ë‚˜ë…¸ì„¸ì»¨ë“œìª½ì„ 0ìœ¼ë¡œ ë§Œë“œëŠ” ë°©ë²•ì´ ìˆì£ (millisecond, microsecond ëŠ” ì‚´ì•„ìˆë„ë¡!). ê·¸ë ‡ê²Œ ëœë‹¤ë©´ h2 db ì˜ nano ë°˜ì˜¬ë¦¼ì„ ë§‰ê³ , mac ê³¼ ubuntu ì—ì„œ ë˜í•œ sync í•  ìˆ˜ ìˆê² ì£ ?

```java
public class DateFormat {
    public static String LocalDateTimeFormat = "yyyy-MM-dd HH:mm:ss.SSSSSS";
    public static DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss.SSSSSS");
    public static ChronoUnit truncation = ChronoUnit.MICROS;    // ë§ˆì´í¬ë¡œ ì´ˆ ë¯¸ë§Œ ì ˆì‚­

    public static LocalDateTime getCurrentTime(){
        LocalDateTime localDateTime = LocalDateTime.now().truncatedTo(truncation);
        System.out.println("now Time: " + localDateTime);
        return localDateTime;
    }


    public static String format(LocalDateTime localDateTime){
        String format = localDateTime.format(DateTimeFormatter.ofPattern(LocalDateTimeFormat));
        return format;
    }
}
```

![img](../../../assets/foxee/8.png)

ì§ ! í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ë§ˆë¬´ë¦¬ë˜ì—ˆì–´ìš”.

### Solution

* ë¬¸ì œì„¤ëª… : Git actions ì—ì„œ h2 ë©”ëª¨ë¦¬ DB ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì‹œ LocalDateTime ì´ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë¬¸ì œ
* ë¬¸ì œê°€ ì™œ ë°œìƒí–ˆë‚˜ìš”?
  * JPA Hibernate êµ¬í˜„ì²´ì—ì„œ Java ì˜ LocalDateTime ê¸°ë³¸ ë§¤í•‘ ê°’ì´ timestamp(6) ì— ë”°ë¥¸ H2 DB nanosecond ë°˜ì˜¬ë¦¼
  * ë‹¤ë¥¸ ìš´ì˜ì²´ì œë¡œ ì¸í•œ ì§€ì› system clock ì°¨ì´
* í•´ê²°ë°©ë²• : `.truncatedTo(ChronoUnit.MICRO)` ë©”ì†Œë“œë¥¼ í†µí•´ ë°˜ì˜¬ë¦¼ ê°€ëŠ¥ì„± ì œê±° ë° ìš´ì˜ì²´ì œ nanosecond ì§€ì› ìœ ë¬´ ì œì™¸

